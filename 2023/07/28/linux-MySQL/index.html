

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="MySQL 开源的MySQL 库表结构：增删改查 数据类型： 1.结构化：表格数据，字段，固定格式 2.非结构化：图片，视频文件 3.半结构化：HTML，XML等，JSON格式的数据—&gt;其实就是一种数据的格式 用户—&gt;DBMS—&gt;数据库，使用DBMS显示数据结构化的形式，可控制权限，DBMS管理工具 java应用程序—调用MySQL内的数据—显示到web页面上 常见数据库产品关系">
<meta property="og:type" content="article">
<meta property="og:title" content="linux MySQL">
<meta property="og:url" content="http://example.com/2023/07/28/linux-MySQL/index.html">
<meta property="og:site_name" content="Mgedu-N80054">
<meta property="og:description" content="MySQL 开源的MySQL 库表结构：增删改查 数据类型： 1.结构化：表格数据，字段，固定格式 2.非结构化：图片，视频文件 3.半结构化：HTML，XML等，JSON格式的数据—&gt;其实就是一种数据的格式 用户—&gt;DBMS—&gt;数据库，使用DBMS显示数据结构化的形式，可控制权限，DBMS管理工具 java应用程序—调用MySQL内的数据—显示到web页面上 常见数据库产品关系">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181320816-1246127538.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181321675-142645545.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181336310-73625099.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181336626-1471110979.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181322091-1571261633.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181322423-411191606.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181322752-1035794337.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181323191-117223815.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181323512-1333718380.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181323778-1633879650.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181324083-943430986.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181324387-1324750877.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181324708-1218696433.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181325114-1469597751.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181325436-1950016114.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181325783-194993639.png">
<meta property="og:image" content="https://img2022.cnblogs.com/blog/2792175/202208/2792175-20220828181326257-802938955.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181326595-1757571807.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181326910-2059997911.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181327232-1719226667.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181327734-407844475.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181328161-275014696.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181328429-1476079978.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181328721-1704275971.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181328963-633085938.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181329284-844691555.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181329559-1210890777.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181329880-1121404312.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181330175-1042091537.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181330454-709513067.png">
<meta property="og:image" content="https://img2022.cnblogs.com/blog/2792175/202208/2792175-20220828181330720-1533465976.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181330998-1234739629.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181331259-1724389273.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181331530-961936863.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181331965-1341432725.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181332502-2039802505.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181332807-701284451.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181333197-1457857707.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181333585-1334419259.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181333908-1357973310.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181334197-1371778287.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181334489-484357407.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181334776-1318141981.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181335069-895777315.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181335359-1422421541.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181335645-1243727137.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181336934-1817115279.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181335941-1360491626.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181337278-1027259050.png">
<meta property="og:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181337762-1156094993.png">
<meta property="article:published_time" content="2023-07-28T19:44:34.000Z">
<meta property="article:modified_time" content="2023-07-30T21:21:41.072Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2023/07/28/linux-MySQL/2792175-20220828181320816-1246127538.png">
  
  
  <title>linux MySQL - Mgedu-N80054</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>JohnBackus</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="linux MySQL">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-07-28 19:44" pubdate>
        July 28, 2023 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      55k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      459 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">linux MySQL</h1>
            
            <div class="markdown-body">
              <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><p><img src="2792175-20220828181320816-1246127538.png" srcset="/img/loading.gif" lazyload alt="image-20220806103220975"></p>
<p>开源的MySQL</p>
<p>库表结构：增删改查</p>
<p>数据类型：</p>
<p>1.结构化：表格数据，字段，固定格式</p>
<p>2.非结构化：图片，视频文件</p>
<p>3.半结构化：HTML，XML等，JSON格式的数据—&gt;其实就是一种数据的格式</p>
<p>用户—&gt;DBMS—&gt;数据库，使用DBMS显示数据结构化的形式，可控制权限，DBMS管理工具</p>
<p>java应用程序—调用MySQL内的数据—显示到web页面上</p>
<h1 id="常见数据库产品"><a href="#常见数据库产品" class="headerlink" title="常见数据库产品"></a>常见数据库产品</h1><p>关系型：MySQL，postgresql(一些软件常见，只支持postgresql)，ORACLE(商业化的关系型数据库)，SQL server(微软商业版数据库)</p>
<p>非关系型：Mongo DB文档数据库</p>
<p>缓存数据库：redis，键值key-value</p>
<p>搜索引擎数据库：elasticsearch</p>
<p><img src="2792175-20220828181321675-142645545.png" srcset="/img/loading.gif" lazyload alt="image-20220806105850314"></p>
<h2 id="常见数据库属性"><a href="#常见数据库属性" class="headerlink" title="常见数据库属性"></a>常见数据库属性</h2><p>行row：表中的每一行，称为记录record，一条记录里面，(姓名：XXX，年龄25，性别男，学号123)</p>
<p>列column：表中的每一列，称为字段，属性(数据的属性：比如姓名，年龄，性别，学号等)，域也可以，awk就是输出域信息(列信息)</p>
<h3 id="主键primary-key"><a href="#主键primary-key" class="headerlink" title="主键primary key"></a>主键primary key</h3><p>一般是一个或者是多个字段的集合，主键内的内容必须是唯一的，不能有重复字样出现(不能出现两个张三+年龄等)，一般为多张表的一致的属性，多张表的主要关系</p>
<p>类似学生基本信息+家长+学习成绩，唯一的关系字段就是学生姓名/年龄等，<em><strong>主键字段不能为空NULL</strong></em></p>
<p>作用在多列上：复合主键，ID/姓名等可以作为主键</p>
<h3 id="唯一键-unique-key"><a href="#唯一键-unique-key" class="headerlink" title="唯一键(unique key)"></a>唯一键(unique key)</h3><p>作用在某一个字段，字段内的数值只能唯一，不能重复，比如年龄age字段，age必须唯一，age就是unique key，唯一键可以有多个</p>
<p>域domain：数据的取值范围，数据的合法性，比如age年龄为0-100岁，sex只能为男/女等</p>
<h3 id="外键-foreign-key-：1对N的关系"><a href="#外键-foreign-key-：1对N的关系" class="headerlink" title="外键(foreign key)：1对N的关系"></a>外键(foreign key)：1对N的关系</h3><p>一个表的一个字段依赖于另一个表的字段，称为外键，可以设置这个为外键，两个表之间存在依赖关系，B表必须有主键或者是唯一键(UK)，一对多的关系</p>
<p><img src="2792175-20220828181336310-73625099.png" srcset="/img/loading.gif" lazyload alt="image-20220806121130233"></p>
<h3 id="N对N的关系：主键-外键关系"><a href="#N对N的关系：主键-外键关系" class="headerlink" title="N对N的关系：主键+外键关系"></a>N对N的关系：主键+外键关系</h3><p>优点：表与表之间的逻辑关系比较清晰</p>
<p>缺点：查询比较麻烦，需要组合查询才能查到</p>
<p><img src="2792175-20220828181336626-1471110979.png" srcset="/img/loading.gif" lazyload alt="image-20220806121753870"></p>
<h1 id="MySQL的范式"><a href="#MySQL的范式" class="headerlink" title="MySQL的范式"></a>MySQL的范式</h1><p>sql表的规范</p>
<p>第一范式1NF：同一列中不能有多个值，即不能出现tom,jerry这样的字符，同时同一个属性不能有多个字段，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs none">editor book        <br>user01 k8s<br>user01 linux<br>user02 python<br></code></pre></td></tr></table></figure>

<p>不能是这样，k8s和linux同属于这个范式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs none">editor book1 book2        <br>user01 k8s   linux<br>user02 python<br></code></pre></td></tr></table></figure>

<p>第二范式：属性完全依赖于主键，主键需要独立</p>
<p>复合主键：必须依赖于多个列，多个字段</p>
<h1 id="yum安装MySQL—-gt-前提：一定要连公网，读取yum源"><a href="#yum安装MySQL—-gt-前提：一定要连公网，读取yum源" class="headerlink" title="yum安装MySQL—&gt;前提：一定要连公网，读取yum源"></a>yum安装MySQL—&gt;前提：一定要连公网，读取yum源</h1><h2 id="1-安装Cent-OS-8版本mysql-8-0"><a href="#1-安装Cent-OS-8版本mysql-8-0" class="headerlink" title="1.安装Cent OS 8版本mysql 8.0"></a>1.安装Cent OS 8版本mysql 8.0</h2><p>1.机器上已经自带mysql8.0，新的Yum源安装mysql的时候会检查yum源的正确性，关闭gpgcheck</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">sed -i &#x27;s/gpgcheck=1/gpgcheck=0/g&#x27; base.repo<br></code></pre></td></tr></table></figure>

<p>2.安装mysql-server，默认8.0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install mysql-server<br>systemctl <span class="hljs-built_in">enable</span> --now mysqld<br><br><span class="hljs-comment">##MySQL初始化，可能需要输入temporary pass</span><br>mysql_insure_installation<br><span class="hljs-built_in">cat</span> /var/log/mysql/mysqld.log | grep temporary<br></code></pre></td></tr></table></figure>

<p>3.进入到mysql，创建一个远程授权用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##创建一个授权用户</span><br>use mysql<br>mysql&gt; CREATE USER <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123&#x27;</span>;<br>Query OK, 0 rows affected (0.04 sec)<br><br>mysql&gt; grant all privileges on *.* to <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, 0 rows affected (0.03 sec)<br><br>flush privileges;<br></code></pre></td></tr></table></figure>

<p>4.navicat连接验证</p>
<h2 id="2-Cent-OS-7安装mysql-8-0"><a href="#2-Cent-OS-7安装mysql-8-0" class="headerlink" title="2.Cent OS 7安装mysql 8.0"></a>2.Cent OS 7安装mysql 8.0</h2><p>1.去到MySQL对应的yum仓库地址，下载你对应发行版版本的仓库</p>
<p><img src="2792175-20220828181322091-1571261633.png" srcset="/img/loading.gif" lazyload alt="image-20220806165809806"></p>
<p>2.下好后安装mysql源，自动在机器上安装yum源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> /etc/yum.repos.d/ | grep mysql<br>mysql-community.repo<br>mysql-community-source.repo<br><br><span class="hljs-comment">##原有的mysql 5.7之类的可以卸载，也可以disabled</span><br><br><span class="hljs-comment">##安装MySQL社区版的rpm包</span><br>yum -y install mysql80-community-release-el7-6.noarch.rpm <br><br><span class="hljs-comment">##查看现有mysql仓库</span><br>yum repolist all | grep mysql<br>mysql-cluster-7.5-community/x86_64           MySQL Cluster 7.5 C disabled<br>mysql-cluster-7.5-community-source           MySQL Cluster 7.5 C disabled<br>mysql-cluster-7.6-community/x86_64           MySQL Cluster 7.6 C disabled<br>mysql-cluster-7.6-community-source           MySQL Cluster 7.6 C disabled<br>mysql-cluster-8.0-community/x86_64           MySQL Cluster 8.0 C disabled<br>mysql-cluster-8.0-community-debuginfo/x86_64 MySQL Cluster 8.0 C disabled<br>mysql-cluster-8.0-community-source           MySQL Cluster 8.0 C disabled<br>mysql-connectors-community/x86_64            MySQL Connectors Co enabled:    199<br>mysql-connectors-community-debuginfo/x86_64  MySQL Connectors Co disabled<br>mysql-connectors-community-source            MySQL Connectors Co disabled<br>mysql-tools-community/x86_64                 MySQL Tools Communi enabled:     92<br>mysql-tools-community-debuginfo/x86_64       MySQL Tools Communi disabled<br>mysql-tools-community-source                 MySQL Tools Communi disabled<br>mysql-tools-preview/x86_64                   MySQL Tools Preview disabled<br>mysql-tools-preview-source                   MySQL Tools Preview disabled<br>mysql57-community/x86_64                     MySQL 5.7 Community disabled<br>mysql57-community-source                     MySQL 5.7 Community disabled<br>mysql80-community/x86_64                     MySQL 8.0 Community enabled:    364 <span class="hljs-comment">##目前只有mysql80-community是up的</span><br>mysql80-community-debuginfo/x86_64           MySQL 8.0 Community disabled<br>mysql80-community-source                     MySQL 8.0 Community disabled<br></code></pre></td></tr></table></figure>

<p>3.因为MySQL安装的时候，会检查mysql.repo源的gpgcheck，所以把gpgcheck关了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> /etc/yum.repos.d/ | grep mysql<br>mysql-community-debuginfo.repo<br>mysql-community.repo<br>mysql-community-source.repo<br><br><span class="hljs-comment">##sed -i替换掉文件内部的内容</span><br><span class="hljs-comment">##sed xxx：只是在bash上显示</span><br><span class="hljs-built_in">cd</span> /etc/yum.repos.d/<br>sed -i <span class="hljs-string">&#x27;s/gpgcheck=1/gpgcheck=0/g&#x27;</span> mysql-community.repo \<br>sed -i <span class="hljs-string">&#x27;s/gpgcheck=1/gpgcheck=0/g&#x27;</span> mysql-community-source.repo \<br>sed -i <span class="hljs-string">&#x27;s/gpgcheck=1/gpgcheck=0/g&#x27;</span> mysql-community-debuginfo.repo<br><br>sed -i <span class="hljs-string">&#x27;s/gpgcheck=1/gpgcheck=0/g&#x27;</span> base.repo<br><br><span class="hljs-comment">##安装mysql8.0</span><br>yum -y install mysql-server<br></code></pre></td></tr></table></figure>

<p>4.初始化mysql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> --now mysqld<br><br><span class="hljs-comment">##初始化，8.0往后一般是不用执行了</span><br>mysql_insure_installation<br><br><span class="hljs-comment">##查看mysqld.log内的临时pass</span><br><span class="hljs-built_in">cat</span> /var/log/mysqld.log | grep temporary<br>2022-08-07T03:37:10.803391Z 6 [Note] [MY-010454] [Server] A temporary password is generated <span class="hljs-keyword">for</span> root@localhost: W6S2wp;pXiyf<br></code></pre></td></tr></table></figure>

<p>5.因为Cent OS 7安装mysql 8.0的话，会有密码策略的显示，是mysql内的一个变量，卸载validate_password密码验证组件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##进入到mysql cli界面</span><br>mysql&gt; UNINSTALL COMPONENT <span class="hljs-string">&#x27;file://component_validate_password&#x27;</span>;<br><br><span class="hljs-comment">##创建远程用户</span><br>use mysql<br>mysql&gt; CREATE USER <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123&#x27;</span>;<br>Query OK, 0 rows affected (0.04 sec)<br><br>mysql&gt; grant all privileges on *.* to <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br>Query OK, 0 rows affected (0.03 sec)<br><br>flush privileges;<br><br><span class="hljs-comment">##登录</span><br>mysql -uroot -p123<br></code></pre></td></tr></table></figure>

<p>6.Navicat验证</p>
<h2 id="3-ubuntu-20-04安装mysql-8-0"><a href="#3-ubuntu-20-04安装mysql-8-0" class="headerlink" title="3.ubuntu 20.04安装mysql 8.0"></a>3.ubuntu 20.04安装mysql 8.0</h2><p>查看apt list | grep mysql-server</p>
<p><img src="2792175-20220828181322423-411191606.png" srcset="/img/loading.gif" lazyload alt="image-20220807122247163"></p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs none">apt install mysql-server -y<br>systemctl status mysql<br>systemctl status mysql<br></code></pre></td></tr></table></figure>

<h2 id="4-rpm二进制包安装MySQL-Linux-generic通用版-—-gt-已编译"><a href="#4-rpm二进制包安装MySQL-Linux-generic通用版-—-gt-已编译" class="headerlink" title="4.rpm二进制包安装MySQL(Linux generic通用版)—&gt;已编译"></a>4.rpm二进制包安装MySQL(Linux generic通用版)—&gt;已编译</h2><p>通用安装脚本：需要先在官网下载好MySQL 二进制包(最新)</p>
<p>需要在测试机上测试一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#Author:		wangxiaochun</span><br><span class="hljs-comment">#QQ: 			29308620</span><br><span class="hljs-comment">#Date: 			2020-02-12</span><br><span class="hljs-comment">#FileName：		install_offline_mysql5.7or8.0_for_centos.sh</span><br><span class="hljs-comment">#URL: 			http://www.wangxiaochun.com</span><br><span class="hljs-comment">#Description：		The test script</span><br><span class="hljs-comment">#Copyright (C): 	2020 All rights reserved</span><br><span class="hljs-comment">#********************************************************************</span><br><span class="hljs-comment">#MySQL Download URL: https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.29-linux-glibc2.12-x86_64.tar.gz</span><br><span class="hljs-comment">#http://mirrors.163.com/mysql/Downloads/MySQL-5.7/mysql-5.7.31-linux-glibc2.12-x86_64.tar.gz</span><br><span class="hljs-comment">#http://mirrors.163.com/mysql/Downloads/MySQL-8.0/mysql-8.0.23-linux-glibc2.12-x86_64.tar.xz</span><br><br>. /etc/init.d/functions <br>SRC_DIR=`/data/mysql`<br><br><br><span class="hljs-comment">##需要先在官网下载好MySQL 二进制包(最新)</span><br>MYSQL=<span class="hljs-string">&#x27;mysql-8.0.30-linux-glibc2.12-x86_64.tar.xz&#x27;</span><br><span class="hljs-comment">#MYSQL=&#x27;mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz&#x27;</span><br><span class="hljs-comment">#MYSQL=&#x27;mysql-8.0.23-linux-glibc2.12-x86_64.tar.xz&#x27;</span><br>MYSQL_ROOT_PASSWORD=123<br><br><br>COLOR=<span class="hljs-string">&#x27;echo -e \E[01;31m&#x27;</span><br>END=<span class="hljs-string">&#x27;\E[0m&#x27;</span><br><br><span class="hljs-function"><span class="hljs-title">check</span></span> ()&#123;<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$UID</span> -ne 0 ]; <span class="hljs-keyword">then</span><br>  action <span class="hljs-string">&quot;当前用户不是root,安装失败&quot;</span> <span class="hljs-literal">false</span><br>  <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">cd</span>  <span class="hljs-variable">$SRC_DIR</span><br><br><span class="hljs-keyword">if</span> [ !  -e <span class="hljs-variable">$MYSQL</span> ];<span class="hljs-keyword">then</span><br>        <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;缺少<span class="hljs-variable">$&#123;MYSQL&#125;</span>文件&quot;</span><span class="hljs-variable">$END</span><br>		<span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;请将相关软件放在<span class="hljs-variable">$&#123;SRC_DIR&#125;</span>目录下&quot;</span><span class="hljs-variable">$END</span><br>        <span class="hljs-built_in">exit</span><br><span class="hljs-keyword">elif</span> [ -e /usr/local/mysql ];<span class="hljs-keyword">then</span><br>        action <span class="hljs-string">&quot;数据库已存在，安装失败&quot;</span> <span class="hljs-literal">false</span><br>        <span class="hljs-built_in">exit</span><br><span class="hljs-keyword">else</span><br>	<span class="hljs-built_in">return</span><br><span class="hljs-keyword">fi</span><br>&#125; <br><br><span class="hljs-function"><span class="hljs-title">install_mysql</span></span>()&#123;<br>    <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;开始安装MySQL数据库...&quot;</span><span class="hljs-variable">$END</span><br>    <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;安装相关依赖&quot;</span><span class="hljs-variable">$END</span><br>    yum  -y -q install libaio numactl-libs<br>    <br>    <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;解压目录&quot;</span><span class="hljs-variable">$END</span><br>    <span class="hljs-comment">#将MYSQL 2进制包解压到/usr/local，这个是写好的；tar xf xxx -C：解压到对应的目录</span><br>    tar xf <span class="hljs-variable">$MYSQL</span> -C /usr/local/<br>    <br>    <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;制作软连接&quot;</span><span class="hljs-variable">$END</span><br>    <span class="hljs-comment">#做一个软连接，将包link到/usr/local下，这里作为默认目录，而不是去修改他的包名</span><br>    <span class="hljs-comment">##sed打印出包名</span><br>    <span class="hljs-comment">##[root@rocky ~]#echo mysql-8.0.30-linux-glibc2.12-x86_64.tar.xz | sed -nr &#x27;s/^(.*[0-9]).*/\1	/p&#x27;</span><br>	<span class="hljs-comment">##mysql-8.0.30-linux-glibc2.12-x86_64</span><br>    MYSQL_DIR=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$MYSQL</span>| sed -nr <span class="hljs-string">&#x27;s/^(.*[0-9]).*/\1/p&#x27;</span>`<br>    <span class="hljs-built_in">ln</span> -s  /usr/local/<span class="hljs-variable">$MYSQL_DIR</span> /usr/local/mysql<br>    <br>    <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;创建mysql用户&quot;</span><span class="hljs-variable">$END</span><br>    <span class="hljs-comment">##安装mysql必须要用roo$COLOR&quot;制作软连接&quot;$ENDt用户/用户组，chown -R表示递归修改权限</span><br>    <span class="hljs-built_in">chown</span> -R  root.root /usr/local/mysql/<br>    <span class="hljs-built_in">id</span> mysql &amp;&gt; /dev/null || &#123; useradd -s /sbin/nologin -g mysql -r  mysql ; action <span class="hljs-string">&quot;创建mysql用户&quot;</span>; &#125;<br>    <br>    <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;准备mysql路径&quot;</span><span class="hljs-variable">$END</span><br>    <span class="hljs-comment">##准备mysql客户端的指令，包括路径等</span><br>    <span class="hljs-comment">##准备环境变量</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;PATH=/usr/local/mysql/bin/:$PATH&#x27;</span> &gt; /etc/profile.d/mysql.sh<br>    .  /etc/profile.d/mysql.sh<br>	<span class="hljs-built_in">ln</span> -s /usr/local/mysql/bin/* /usr/bin/<br>    <span class="hljs-built_in">cat</span> &gt; /etc/my.cnf &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">    </span><br><span class="hljs-string">##往my.cnf内写好对应的参数变量，比如对应的数据目录，日志目录，运行Pid</span><br><span class="hljs-string">##server-id可以指定为IP的最后一位</span><br><span class="hljs-string"></span><br><span class="hljs-string">##[mysqld]服务器端配置</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">server-id=`hostname -I|awk &#x27;&#123;print $1&#125;&#x27;`</span><br><span class="hljs-string">log-bin ##开启binlog</span><br><span class="hljs-string">datadir=/data/mysql ##指定数据目录dir</span><br><span class="hljs-string">socket=/data/mysql/mysql.sock   ##指定本地socket连接                                                                                                 </span><br><span class="hljs-string">log-error=/data/mysql/mysql.log ##错误日志</span><br><span class="hljs-string">pid-file=/data/mysql/mysql.pid  ##mysql.pid进程</span><br><span class="hljs-string"></span><br><span class="hljs-string">##客户端配置，或者叫mysql端，[mysql]</span><br><span class="hljs-string">[client]</span><br><span class="hljs-string">socket=/data/mysql/mysql.sock ##本地客户端通过socket连接到本地localhost用户</span><br><span class="hljs-string"></span><br><span class="hljs-string">EOF</span><br>	<span class="hljs-comment">##创建data数据目录</span><br>    [ -d /data ] || <span class="hljs-built_in">mkdir</span> /data<br>	mysqld --initialize-insecure --user=mysql --datadir=/data/mysql <br>    <span class="hljs-built_in">cp</span> /usr/local/mysql/support-files/mysql.server  /etc/init.d/mysqld <span class="hljs-comment">##启动mysqld</span><br>    chkconfig --add mysqld<br>    chkconfig mysqld on<br>    service mysqld start<br>    [ $? -ne 0 ] &amp;&amp; &#123; <span class="hljs-variable">$COLOR</span><span class="hljs-string">&quot;数据库启动失败，退出!&quot;</span><span class="hljs-variable">$END</span>;<span class="hljs-built_in">exit</span>; &#125;<br>    <span class="hljs-comment">#MYSQL_OLDPASSWORD=`awk &#x27;/A temporary password/&#123;print $NF&#125;&#x27; /data/mysql/mysql.log`</span><br>    <span class="hljs-comment">#mysqladmin  -uroot -p$MYSQL_OLDPASSWORD password $MYSQL_ROOT_PASSWORD &amp;&gt;/dev/null</span><br>	<span class="hljs-built_in">sleep</span> 3<br>    mysqladmin  -uroot  password <span class="hljs-variable">$MYSQL_ROOT_PASSWORD</span> &amp;&gt;/dev/null<br>    action <span class="hljs-string">&quot;数据库安装完成&quot;</span> <br>&#125;<br><br>check<br>install_mysql<br><br><span class="hljs-comment">##修改MySQL内的显示prompt</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">export</span> MYSQL_PS1=<span class="hljs-string">&quot;(\\u@\\h) [\\d]\\&gt;&quot;</span> &gt;&gt; .bashrc<br><span class="hljs-built_in">source</span> .bashrc<br></code></pre></td></tr></table></figure>

<p>Linux通用版，已经经过源码编译的包进行安装</p>
<p>MySQL程序安装分为程序路径(APP)和数据路径(DATA)</p>
<p>1.下载好对应的二进制包，下载社区版的服务器端</p>
<p><img src="2792175-20220828181322752-1035794337.png" srcset="/img/loading.gif" lazyload alt="image-20220811231642480"></p>
<p>下载这个tar包，注意服务器的架构位数</p>
<p><img src="2792175-20220828181323191-117223815.png" srcset="/img/loading.gif" lazyload alt="image-20220811231730080"></p>
<p>2.安装相关依赖包，创建mysql服务用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install libaio numactl-libs<br><br><span class="hljs-comment">##建立MySQL相关用户</span><br>-r：建立系统账号，系统账号在0-1000号之间<br>-g mysql：属于Mysql组<br>-s:用户登陆后使用的shell环境<br>useradd -r -g mysql -s /sbin/nologin mysql<br></code></pre></td></tr></table></figure>

<p>3.解压数据包到对应路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">tar xf <br></code></pre></td></tr></table></figure>

<h3 id="二进制包安装可能出现的问题"><a href="#二进制包安装可能出现的问题" class="headerlink" title="二进制包安装可能出现的问题"></a>二进制包安装可能出现的问题</h3><p>1.缺少lib依赖，在登陆mysql的时候</p>
<p><img src="2792175-20220828181323512-1333718380.png" srcset="/img/loading.gif" lazyload alt="image-20220814102137009"></p>
<p>解决办法：先检查libaio依赖包是否有安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">rpm -q libaio numactl-libs<br></code></pre></td></tr></table></figure>

<p>发现安装的是6.1版本，系统内只认so.5包，所以执行ln -s软连接，将我们新安装的包ln -s到系统的so.5 lib依赖中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">ln -s /usr/lib64/libtinfo.so.6.1 /usr/lib64/libtinfo.so.5<br></code></pre></td></tr></table></figure>

<p>成功</p>
<p><img src="2792175-20220828181323778-1633879650.png" srcset="/img/loading.gif" lazyload alt="image-20220814102353351"></p>
<p>2.无法实现登录到caching</p>
<p>在/etc/my.cnf内写入skip-grant-tables</p>
<p>重启mysql服务</p>
<h3 id="实现使用systemd管理mysqld-service：编写服务脚本"><a href="#实现使用systemd管理mysqld-service：编写服务脚本" class="headerlink" title="实现使用systemd管理mysqld.service：编写服务脚本"></a>实现使用systemd管理mysqld.service：编写服务脚本</h3><p>nginx.service编写案例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">###写的路径，也可以写在/lib，/lib就是/usr/lib的link</span><br><br><span class="hljs-comment"># /usr/lib/systemd/system/nginx.service </span><br>[Unit]<br>Description=The nginx HTTP and reverse proxy server <span class="hljs-comment">##服务说明</span><br>After=network-online.target remote-fs.target nss-lookup.target <span class="hljs-comment">##依赖关系：有网络network，remote远程主机；需要先启动这些服务</span><br>Wants=network-online.target <span class="hljs-comment">##必须依赖：网络服务</span><br><br>[Service]<br>Type=forking<br>PIDFile=/run/nginx.pid<br><span class="hljs-comment"># Nginx will fail to start if /run/nginx.pid already exists but has the wrong</span><br><span class="hljs-comment"># SELinux context. This might happen when running `nginx -t` from the cmdline.</span><br><span class="hljs-comment"># https://bugzilla.redhat.com/show_bug.cgi?id=1268621</span><br>ExecStartPre=/usr/bin/rm -f /run/nginx.pid 		<span class="hljs-comment">##启动进程，启动前需要做什么---&gt;先删除掉原有的nginx.pid进程</span><br>ExecStartPre=/usr/sbin/nginx -t					<span class="hljs-comment">##检查nginx的配置文件是否有问题：nginx -t---&gt;检查的是nginx.conf，检查语法错误</span><br>ExecStart=/usr/sbin/nginx						<span class="hljs-comment">##执行systemctl start xxx的时候，执行的就/usr/sbin/nginx这个可执行文件，后续如果是源码编译安装想放到systemd执行，可以写成例如/usr/local/nginx/sbin/nginx或者/usr/local/tomcat/bin/startup.sh</span><br>ExecReload=/usr/sbin/nginx -s reload 			<span class="hljs-comment">##执行reload，nginx执行文件就是 nginx -s reload</span><br><br>KillSignal=SIGQUIT<br>TimeoutStopSec=5<br>KillMode=process<br>PrivateTmp=<span class="hljs-literal">true</span><br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>

<p>进入到对应目录，创建.service文件，授权644</p>
<p>配置完成后，记得重新加载守护进程，systemctl daemon-reload</p>
<p>预检查：ExecStartPre：没有这个mysqld</p>
<p><img src="2792175-20220828181324083-943430986.png" srcset="/img/loading.gif" lazyload alt="image-20220814111924630"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/lib/systemd/system<br><span class="hljs-built_in">touch</span> mysqld.service<br><span class="hljs-built_in">chmod</span> 644 mysqld.service<br><br>[Unit]<br>Description=MySQL Community Server <br>After=network.target <span class="hljs-comment">##服务依赖，显示在bash上面</span><br>After=syslog.target<br><br>[Install]<br>WantedBy=multi-user.target<br>Alias=mysqld.service<br><br>[Service]<br><span class="hljs-comment">##这里是整个service</span><br>User=mysql<br>Group=mysql<br><br>PIDfile=/data/mysql/mysql.pid<br><br><span class="hljs-comment"># Execute pre and post scripts as root</span><br>PermissionsStartOnly=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># Needed to create system tables etc.</span><br><span class="hljs-comment">#ExecStartPre=/usr/bin/mysql-systemd-start pre</span><br><br><span class="hljs-comment"># Start main service</span><br><span class="hljs-comment">#ExecStart=/usr/bin/mysqld_safe --basedir=/usr</span><br><span class="hljs-comment">#ExecStart=/usr/local/mysql/bin/mysqld --daemonize --pid-file=/data/mysql/mysql.pid $MYSQLD_OPTS</span><br><span class="hljs-comment">##启动脚本，启动对应的执行文件，类似nginx</span><br>ExecStart=/usr/local/mysql/bin/mysqld<br><br><span class="hljs-comment"># Don&#x27;t signal startup success before a ping works</span><br><span class="hljs-comment">#ExecStartPost=/usr/bin/mysql-systemd-start post</span><br><br><span class="hljs-comment"># Give up if ping don&#x27;t get an answer</span><br>TimeoutSec=600<br><br>Restart=always<br>PrivateTmp=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>

<p>编辑PS1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">export</span> MYSQL_PS1=<span class="hljs-string">&quot;(\\u@\\h) [\\d]\\&gt;&quot;</span> &gt;&gt; .bashrc<br><span class="hljs-built_in">source</span> .bashrc<br></code></pre></td></tr></table></figure>

<h2 id="5-源码包安装MySQL—-gt-需要先进行编译cmake"><a href="#5-源码包安装MySQL—-gt-需要先进行编译cmake" class="headerlink" title="5.源码包安装MySQL—&gt;需要先进行编译cmake"></a>5.源码包安装MySQL—&gt;需要先进行编译cmake</h2><p>编译要求：编译机器的内存必须足够大，就像在java环境编译java包一样，同样是很吃PC机的内存的</p>
<p>建议调整vmware虚拟机：8c16g</p>
<h2 id="6-docker安装MySQL"><a href="#6-docker安装MySQL" class="headerlink" title="6.docker安装MySQL"></a>6.docker安装MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install docker-ce<br>docker search mysql:8<br></code></pre></td></tr></table></figure>

<h1 id="MySQL安全加固"><a href="#MySQL安全加固" class="headerlink" title="MySQL安全加固"></a>MySQL安全加固</h1><p>ODBC：微软调用数据库的接口</p>
<p>JDBC：JAVA语言调用SQL的语法，jdbc：3306等等</p>
<p>MySQL和mariadb的关系：mariadb是MySQL的一个分支，在Cent OS 7上自带mariadb数据库，语法结构，数据库结构完全一致</p>
<p>存储引擎：innodb，intradb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##yum info mysql-server</span><br><span class="hljs-comment">##yum info mariadb</span><br><span class="hljs-comment">##apt list mysql-server</span><br>Cent OS 7：自带mariadb Version     : 5.5.68<br>Cent OS 8(rocky 8.6)：自带MySQL 8.0.26<br>ubuntu 20.04：自带MySQL 8.0.30<br><br>sed -i <span class="hljs-string">&#x27;s/DNS/#DNS/g&#x27;</span> /etc/sysconfig/network-scripts/ifcfg-ens33 ; systemctl restart network<br>mysql&gt; status <span class="hljs-comment">##查看MySQL状态，可以看MySQL一些版本，字符集等</span><br>mysql&gt; status<br>--------------<br>mysql  Ver 8.0.30 <span class="hljs-keyword">for</span> Linux on x86_64 (MySQL Community Server - GPL)<br><br>Connection <span class="hljs-built_in">id</span>:		8<br>Current database:	<br>Current user:		root@localhost<br>SSL:			Not <span class="hljs-keyword">in</span> use<br>Current pager:		stdout<br>Using outfile:		<span class="hljs-string">&#x27;&#x27;</span><br>Using delimiter:	;<br>Server version:		8.0.30 MySQL Community Server - GPL<br>Protocol version:	10<br>Connection:		Localhost via UNIX socket<br>Server characterset:	utf8mb4  <span class="hljs-comment">##指定字符集</span><br>Db     characterset:	utf8mb4<br>Client characterset:	utf8mb4<br>Conn.  characterset:	utf8mb4<br>UNIX socket:		/var/lib/mysql/mysql.sock<br>Binary data as:		Hexadecimal<br>Uptime:			5 min 4 sec<br><br>Threads: 2  Questions: 5  Slow queries: 0  Opens: 119  Flush tables: 3  Open tables: 38  Queries per second avg: 0.016<br>--------------<br></code></pre></td></tr></table></figure>

<h2 id="MySQL8-0修改密码"><a href="#MySQL8-0修改密码" class="headerlink" title="MySQL8.0修改密码"></a>MySQL8.0修改密码</h2><p>1.如果忘记密码，使用root登录，进入/etc/my.cnf的mysqld修改</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">echo &quot;skip-grant-tables&quot; <span class="hljs-operator">&gt;&gt;</span> <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br>systemctl restart mysqld<br></code></pre></td></tr></table></figure>

<p>2.进入到服务器，修改密码，本地登录用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>uroot<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123&#x27;</span>;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123&#x27;</span>;<br>flush privileges;<br><br><span class="hljs-keyword">select</span> version();<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+</span><br><span class="hljs-operator">|</span> version() <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">8.0</span><span class="hljs-number">.30</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>3.成功登录</p>
<p>4.注释掉skip-grant-tables，恢复本地localhost访问</p>
<h2 id="mysql-secure-installation：系统自带安全加固脚本"><a href="#mysql-secure-installation：系统自带安全加固脚本" class="headerlink" title="mysql_secure_installation：系统自带安全加固脚本"></a>mysql_secure_installation：系统自带安全加固脚本</h2><p>生产环境中建议执行的脚本</p>
<p>在mysql5.5中会存在匿名用户，anoymous用户，脚本中可以remove掉；删除掉test的数据库</p>
<p>匿名账号：可以直接登陆到MySQL内，只有test库的操作权限，不能让所有人都有权限登录</p>
<p>作用：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http">设置root密码<br>禁止root远程登录(也可以允许)，allow root login on remotely<br>删除匿名用户<br>删除test数据库<br></code></pre></td></tr></table></figure>

<p>在老版本(5.5 5.6 5.7左右)，需要执行一下安全脚本，在8.0以上得到安全加固了，比较稳定</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##查看user和host(用户和主机)，从Mysql库的User表内查询</span><br>mysql&gt; select user,host from mysql.user;<br>+------------------+-----------+<br>| user             | host      |<br>+------------------+-----------+<br>| root             | %         |<br>| mysql.infoschema | localhost |<br>| mysql.session    | localhost |<br>| mysql.sys        | localhost |<br>| root             | localhost |<br>+------------------+-----------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br><span class="hljs-comment">##查看mysql的版本</span><br>mysql&gt; select version();<br><br><span class="hljs-comment">##查看现有的库</span><br>mysql&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.01 sec)<br></code></pre></td></tr></table></figure>

<h2 id="mysql-prompt：修改MySQL的命令行-bashrc显示"><a href="#mysql-prompt：修改MySQL的命令行-bashrc显示" class="headerlink" title="mysql-prompt：修改MySQL的命令行.bashrc显示"></a>mysql-prompt：修改MySQL的命令行.bashrc显示</h2><p>可以将mysql-prompt的变量写入到系统的变量中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim .bashrc<br><span class="hljs-built_in">export</span> MYSQL_PS1=<span class="hljs-string">&quot;(\\u@\\h) [\\d]\\_&quot;</span><br>\\u：代表当前登录MySQL的用户<br>\\h：当前登录的主机host，现在为<span class="hljs-built_in">local</span>后使用<br>[\\d]：表示default database，用户自行选择的库<br><br><br>显示效果：<br>(root@localhost) [(none)]&gt;use mysql<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>(root@localhost) [mysql]&gt;<br></code></pre></td></tr></table></figure>

<h1 id="MySQL服务端配置文件：my-cnf"><a href="#MySQL服务端配置文件：my-cnf" class="headerlink" title="MySQL服务端配置文件：my.cnf"></a>MySQL服务端配置文件：my.cnf</h1><p>cat /etc/my.cnf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs none">datadir=/var/lib/mysql<br>socket=/var/lib/mysql/mysql.sock<br><br>log-error=/var/log/mysqld.log<br>pid-file=/var/run/mysqld/mysqld.pid<br></code></pre></td></tr></table></figure>

<p>主要的选项，一般都是写在mysqld服务端的命令指令</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">[mysqld] 服务端<br>[mysql]	客户端<br></code></pre></td></tr></table></figure>

<h2 id="通过禁用远程连接，实现本地socket连接"><a href="#通过禁用远程连接，实现本地socket连接" class="headerlink" title="通过禁用远程连接，实现本地socket连接"></a>通过禁用远程连接，实现本地socket连接</h2><p>一般用于数据库维护的阶段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##先查看mysql的业务端口</span><br>ss -ntl | grep 3306<br>LISTEN     0      128       [::]:3306                  [::]:*                  <br>LISTEN     0      70        [::]:33060                 [::]:*                  <br><br><span class="hljs-comment">##写配置</span><br>vim /etc/my.cnf<br>[mysqld] ---&gt;服务端指令<br>skip-networking=on<br>systemctl restart mysqld---&gt;重启服务<br><br>一般来讲，vim /etc/my.cnf还是选择<span class="hljs-comment">#注释掉好一些，也可以用on/off 1/0 true/false来代替</span><br><br><span class="hljs-comment">##再次查看端口，发现是没有端口了，但是通过本地的socket套接字还是可以连接的</span><br>[root@master ~]<span class="hljs-comment">#ss -ntl | grep 3306</span><br>[root@master ~]<span class="hljs-comment">#mysql -uroot -p123</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>---&gt;证明是socket连接的<br>(root@localhost) [(none)]&gt;status<br>UNIX socket:		/var/lib/mysql/mysql.sock<br><br><span class="hljs-comment">##禁用看下status，看下MySQL的连接状态</span><br>发现这里是不能连接的证明起作用了，因为端口已经down了<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181324387-1324750877.png" srcset="/img/loading.gif" lazyload alt="image-20220810214947555"></p>
<h1 id="mysql脚本文件：直接写SQL语句"><a href="#mysql脚本文件：直接写SQL语句" class="headerlink" title="mysql脚本文件：直接写SQL语句"></a>mysql脚本文件：直接写SQL语句</h1><p>vim test.sql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs none">use mysql<br>select version()<br>select user,host from user;<br></code></pre></td></tr></table></figure>

<p>mysql test.sql：执行该脚本</p>
<p>MySQL系统库：mysql库</p>
<h1 id="MySQL默认的存储数据的目录：-var-lib-mysql"><a href="#MySQL默认的存储数据的目录：-var-lib-mysql" class="headerlink" title="MySQL默认的存储数据的目录：/var/lib/mysql"></a>MySQL默认的存储数据的目录：/var/lib/mysql</h1><p>其实MySQL在Linux内就是一个个文件夹，一个库就是一个目录，比如说mysql库就是一个目录</p>
<p><img src="2792175-20220828181324708-1218696433.png" srcset="/img/loading.gif" lazyload alt="image-20220810210813191"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##创建一个库，test1</span><br>(root@localhost) [(none)]&gt;create database test1 charset utf8;<br>Query OK, 1 row affected, 1 warning (0.00 sec)<br><br><span class="hljs-comment">##删除一个库，删除了磁盘上对应的目录</span><br>drop database test1<br></code></pre></td></tr></table></figure>

<p>有test了</p>
<p><img src="2792175-20220828181325114-1469597751.png" srcset="/img/loading.gif" lazyload alt="image-20220810211525341"></p>
<h1 id="MySQL常见的客户端命令"><a href="#MySQL常见的客户端命令" class="headerlink" title="MySQL常见的客户端命令"></a>MySQL常见的客户端命令</h1><p><img src="2792175-20220828181325436-1950016114.png" srcset="/img/loading.gif" lazyload alt="image-20220810212350199"></p>
<h2 id="1-mysqladmin"><a href="#1-mysqladmin" class="headerlink" title="1.mysqladmin"></a>1.mysqladmin</h2><p>-uroot -p123：这个需要知道MySQL的密码，没有的话不起作用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##1.查看MySQL的性能指标，线程数，处理的任务数，慢查询等等一些性能指标</span><br>mysqladmin -uroot -p123 status<br>mysqladmin: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>Uptime: 2198  Threads: 3  Questions: 52  Slow queries: 0  Opens: 180  Flush tables: 3  Open tables: 99  Queries per second avg: 0.023<br><br><span class="hljs-comment">##2.计划任务实现MySQL故障重启</span><br>mysqladmin -uroot -p123 ping <br>mysqladmin: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>mysqld is alive<br><br><span class="hljs-comment">##如果返回的$?为1，不正常，则重启MySQL(不常用)</span><br>mysql -uroot -p123 ping || systemctl restart mysqld<br></code></pre></td></tr></table></figure>

<p>2.查看表的状态</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">table</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;emp&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h1 id="SQL语言规范"><a href="#SQL语言规范" class="headerlink" title="SQL语言规范"></a>SQL语言规范</h1><p>sql脚本：test.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1.</span><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> mysql.user;<br><span class="hljs-keyword">SELECT</span>，<span class="hljs-keyword">FROM</span>都为关键字，mysql.user是库.表名，关键字可以大写<br><span class="hljs-comment">/*多行注释*/</span>	<br><br>##多个子句<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> #子句<br><span class="hljs-keyword">FROM</span> mysql.user #子句<br><span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span> #子句<br></code></pre></td></tr></table></figure>

<p>声明式语言</p>
<p>基本分类：</p>
<p>1.DDL语句：数据定义，包括CREATE创建，DROP删除，ALTER替换</p>
<p>2.DML语句：数据操作，INSERT插入，DELETE删除，UPDATE更新，增删改</p>
<p>3.DQL语句：查询，SELECT</p>
<p>4.DCL语句：数据控制语言，GRANT授权，REVOKE收回权限</p>
<p>5.TCL语句：事务控制语言，COMMIT提交事务，ROLLBACK回滚，SAVEPOINT存储点吧</p>
<p>查看SQL语句帮助</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查看<span class="hljs-keyword">SQL</span>帮助<br>mysql<span class="hljs-operator">&gt;</span> help <span class="hljs-keyword">select</span><br>(root<span class="hljs-variable">@localhost</span>) [mysql]<span class="hljs-operator">&gt;</span>help <span class="hljs-keyword">select</span><br>Name: <span class="hljs-string">&#x27;SELECT&#x27;</span><br>Description:<br>Syntax:<br><span class="hljs-keyword">SELECT</span><br>    [<span class="hljs-keyword">ALL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-operator">|</span> DISTINCTROW ]<br>    [HIGH_PRIORITY]<br>    [STRAIGHT_JOIN]<br>    [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]<br>    [SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]<br>    select_expr [, select_expr] ...<br>    [into_option]<br></code></pre></td></tr></table></figure>

<p>做修改前，或者是做重大变更，记得做一个快照</p>
<h2 id="1-字符集配置"><a href="#1-字符集配置" class="headerlink" title="1.字符集配置"></a>1.字符集配置</h2><p>字符集的影响：在于你是否能够插入中文的记录到表内，表内的字段是否支持中文</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql">在MySQL8<span class="hljs-number">.0</span>默认版本：utf8mb4<br>全世界通用字符：uft8<br>简体中文：gb2312<br><br>##MySQL8<span class="hljs-number">.0</span>都是用的utf8mb4，默认是用的<br>[mysql]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%character%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Variable_name            <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>                                                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> character_set_client     <span class="hljs-operator">|</span> utf8mb4                                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_connection <span class="hljs-operator">|</span> utf8mb4                                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_database   <span class="hljs-operator">|</span> utf8mb4                                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_filesystem <span class="hljs-operator">|</span> <span class="hljs-type">binary</span>                                                         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_results    <span class="hljs-operator">|</span> utf8mb4                                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_server     <span class="hljs-operator">|</span> utf8mb4                                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_system     <span class="hljs-operator">|</span> utf8mb3                                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_sets_dir       <span class="hljs-operator">|</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span><span class="hljs-keyword">local</span><span class="hljs-operator">/</span>mysql<span class="hljs-number">-8.0</span><span class="hljs-number">.30</span><span class="hljs-operator">-</span>linux<span class="hljs-operator">-</span>glibc2<span class="hljs-number">.12</span><span class="hljs-operator">-</span>x86_64<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>charsets<span class="hljs-operator">/</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------------------------------------------+</span><br><br>##MySQL <span class="hljs-number">5.6</span>服务端<span class="hljs-operator">/</span>客户端都是使用的不标准的字符集，服务端还是latin拉丁字符集<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%char%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------+</span><br><span class="hljs-operator">|</span> Variable_name            <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>                      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------+</span><br><span class="hljs-operator">|</span> character_set_client     <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_connection <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_database   <span class="hljs-operator">|</span> latin1                     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_filesystem <span class="hljs-operator">|</span> <span class="hljs-type">binary</span>                     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_results    <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_server     <span class="hljs-operator">|</span> latin1                     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_set_system     <span class="hljs-operator">|</span> utf8                       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> character_sets_dir       <span class="hljs-operator">|</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>charsets<span class="hljs-operator">/</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------+----------------------------+</span><br><span class="hljs-number">8</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>Linux系统内输出字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs none">[root@rocky ~]#echo $LANG<br>zh_CN.UTF-8<br></code></pre></td></tr></table></figure>

<p>查看MySQL数据库可用字符集，常用的几个</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span>;<br>(root<span class="hljs-variable">@localhost</span>) [mysql]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> <span class="hljs-type">character</span> <span class="hljs-keyword">set</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+---------------------------------+---------------------+--------+</span><br><span class="hljs-operator">|</span> Charset  <span class="hljs-operator">|</span> Description                     <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-keyword">collation</span>   <span class="hljs-operator">|</span> Maxlen <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+---------------------------------+---------------------+--------+</span><br><span class="hljs-operator">|</span> armscii8 <span class="hljs-operator">|</span> ARMSCII<span class="hljs-number">-8</span> Armenian              <span class="hljs-operator">|</span> armscii8_general_ci <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> ascii    <span class="hljs-operator">|</span> US ASCII                        <span class="hljs-operator">|</span> ascii_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> big5     <span class="hljs-operator">|</span> Big5 Traditional Chinese        <span class="hljs-operator">|</span> big5_chinese_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-type">binary</span>   <span class="hljs-operator">|</span> <span class="hljs-type">Binary</span> pseudo charset           <span class="hljs-operator">|</span> <span class="hljs-type">binary</span>              <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp1250   <span class="hljs-operator">|</span> Windows Central European        <span class="hljs-operator">|</span> cp1250_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp1251   <span class="hljs-operator">|</span> Windows Cyrillic                <span class="hljs-operator">|</span> cp1251_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp1256   <span class="hljs-operator">|</span> Windows Arabic                  <span class="hljs-operator">|</span> cp1256_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp1257   <span class="hljs-operator">|</span> Windows Baltic                  <span class="hljs-operator">|</span> cp1257_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp850    <span class="hljs-operator">|</span> DOS West European               <span class="hljs-operator">|</span> cp850_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp852    <span class="hljs-operator">|</span> DOS Central European            <span class="hljs-operator">|</span> cp852_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp866    <span class="hljs-operator">|</span> DOS Russian                     <span class="hljs-operator">|</span> cp866_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> cp932    <span class="hljs-operator">|</span> SJIS <span class="hljs-keyword">for</span> Windows Japanese       <span class="hljs-operator">|</span> cp932_japanese_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> dec8     <span class="hljs-operator">|</span> <span class="hljs-type">DEC</span> West European               <span class="hljs-operator">|</span> dec8_swedish_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> eucjpms  <span class="hljs-operator">|</span> UJIS <span class="hljs-keyword">for</span> Windows Japanese       <span class="hljs-operator">|</span> eucjpms_japanese_ci <span class="hljs-operator">|</span>      <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> euckr    <span class="hljs-operator">|</span> EUC<span class="hljs-operator">-</span>KR Korean                   <span class="hljs-operator">|</span> euckr_korean_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> gb18030  <span class="hljs-operator">|</span> China <span class="hljs-type">National</span> Standard GB18030 <span class="hljs-operator">|</span> gb18030_chinese_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> gb2312   <span class="hljs-operator">|</span> GB2312 Simplified Chinese       <span class="hljs-operator">|</span> gb2312_chinese_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> gbk      <span class="hljs-operator">|</span> GBK Simplified Chinese          <span class="hljs-operator">|</span> gbk_chinese_ci      <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> geostd8  <span class="hljs-operator">|</span> GEOSTD8 Georgian                <span class="hljs-operator">|</span> geostd8_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> greek    <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-7</span> Greek                <span class="hljs-operator">|</span> greek_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> hebrew   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-8</span> Hebrew               <span class="hljs-operator">|</span> hebrew_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> hp8      <span class="hljs-operator">|</span> HP West European                <span class="hljs-operator">|</span> hp8_english_ci      <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> keybcs2  <span class="hljs-operator">|</span> DOS Kamenicky Czech<span class="hljs-operator">-</span>Slovak      <span class="hljs-operator">|</span> keybcs2_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> koi8r    <span class="hljs-operator">|</span> KOI8<span class="hljs-operator">-</span>R Relcom Russian           <span class="hljs-operator">|</span> koi8r_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> koi8u    <span class="hljs-operator">|</span> KOI8<span class="hljs-operator">-</span>U Ukrainian                <span class="hljs-operator">|</span> koi8u_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> latin1   <span class="hljs-operator">|</span> cp1252 West European            <span class="hljs-operator">|</span> latin1_swedish_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> latin2   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-2</span> Central European     <span class="hljs-operator">|</span> latin2_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> latin5   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-9</span> Turkish              <span class="hljs-operator">|</span> latin5_turkish_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> latin7   <span class="hljs-operator">|</span> ISO <span class="hljs-number">8859</span><span class="hljs-number">-13</span> Baltic              <span class="hljs-operator">|</span> latin7_general_ci   <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> macce    <span class="hljs-operator">|</span> Mac Central European            <span class="hljs-operator">|</span> macce_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> macroman <span class="hljs-operator">|</span> Mac West European               <span class="hljs-operator">|</span> macroman_general_ci <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sjis     <span class="hljs-operator">|</span> Shift<span class="hljs-operator">-</span>JIS Japanese              <span class="hljs-operator">|</span> sjis_japanese_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> swe7     <span class="hljs-operator">|</span> <span class="hljs-number">7</span>bit Swedish                    <span class="hljs-operator">|</span> swe7_swedish_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> tis620   <span class="hljs-operator">|</span> TIS620 Thai                     <span class="hljs-operator">|</span> tis620_thai_ci      <span class="hljs-operator">|</span>      <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> ucs2     <span class="hljs-operator">|</span> UCS<span class="hljs-number">-2</span> Unicode                   <span class="hljs-operator">|</span> ucs2_general_ci     <span class="hljs-operator">|</span>      <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> ujis     <span class="hljs-operator">|</span> EUC<span class="hljs-operator">-</span>JP Japanese                 <span class="hljs-operator">|</span> ujis_japanese_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> utf16    <span class="hljs-operator">|</span> UTF<span class="hljs-number">-16</span> Unicode                  <span class="hljs-operator">|</span> utf16_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> utf16le  <span class="hljs-operator">|</span> UTF<span class="hljs-number">-16</span>LE Unicode                <span class="hljs-operator">|</span> utf16le_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> utf32    <span class="hljs-operator">|</span> UTF<span class="hljs-number">-32</span> Unicode                  <span class="hljs-operator">|</span> utf32_general_ci    <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> utf8mb3  <span class="hljs-operator">|</span> UTF<span class="hljs-number">-8</span> Unicode                   <span class="hljs-operator">|</span> utf8mb3_general_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> utf8mb4  <span class="hljs-operator">|</span> UTF<span class="hljs-number">-8</span> Unicode                   <span class="hljs-operator">|</span> utf8mb4_0900_ai_ci  <span class="hljs-operator">|</span>      <span class="hljs-number">4</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+---------------------------------+---------------------+--------+</span><br></code></pre></td></tr></table></figure>

<p>配置字符集：服务端、客户端等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br>[mysqld]<br><span class="hljs-keyword">default</span><span class="hljs-operator">-</span><span class="hljs-type">character</span><span class="hljs-operator">-</span><span class="hljs-keyword">set</span><span class="hljs-operator">=</span>utf8mb4<br><br>[mysql]<span class="hljs-operator">/</span>[client]<br><span class="hljs-keyword">default</span><span class="hljs-operator">-</span><span class="hljs-type">character</span><span class="hljs-operator">-</span><span class="hljs-keyword">set</span><span class="hljs-operator">=</span>utf8mb4<br></code></pre></td></tr></table></figure>

<p>查看排序规则，基本用的都是uft8mb4的排序规则，一般来说，字符集绑定了排序规则使用；排序规则也可以修改，涉及到你查询表内的记录，数据是如何排序的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;collation%&#x27;</span><br>(root<span class="hljs-variable">@localhost</span>) [mysql]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;collation%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+--------------------+</span><br><span class="hljs-operator">|</span> Variable_name        <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>              <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+--------------------+</span><br><span class="hljs-operator">|</span> collation_connection <span class="hljs-operator">|</span> utf8mb4_0900_ai_ci <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> collation_database   <span class="hljs-operator">|</span> utf8mb4_0900_ai_ci <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> collation_server     <span class="hljs-operator">|</span> utf8mb4_0900_ai_ci <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+--------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="2-管理数据库，字符集，排序"><a href="#2-管理数据库，字符集，排序" class="headerlink" title="2.管理数据库，字符集，排序"></a>2.管理数据库，字符集，排序</h2><p>show：查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查看数据库，表<br><span class="hljs-keyword">show</span> databases<br><span class="hljs-keyword">show</span> tables<br></code></pre></td></tr></table></figure>

<p>CREATE：创建，不能创建已经存在的库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">##创建数据库，指定字符集<br><span class="hljs-keyword">create</span> database catyer <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8mb4;<br><br>##创建数据库，指定字符集，指定排序规则，不同的服务可能排序规则不同<br>utf8_bin：忽略大小写<br><span class="hljs-keyword">create</span> database catyer <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> utf8mb4 <span class="hljs-keyword">collate</span> utf8_bin;<br></code></pre></td></tr></table></figure>

<p>alter修改数据库的字符集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">##先<span class="hljs-keyword">show</span>查看数据库的属性，默认字符集为utf8mb4<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> database catyer<br>catyer   <span class="hljs-operator">|</span> <span class="hljs-keyword">CREATE</span> DATABASE `catyer` <span class="hljs-comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="hljs-comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span> <br><br>##修改字符集<br><span class="hljs-keyword">alter</span> database catyer charset utf8<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> database catyer<br></code></pre></td></tr></table></figure>

<p>DROP：删除数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> database catyer;<br></code></pre></td></tr></table></figure>

<h2 id="3-数据类型"><a href="#3-数据类型" class="headerlink" title="3.数据类型"></a>3.数据类型</h2><p>整数</p>
<p><img src="2792175-20220828181325783-194993639.png" srcset="/img/loading.gif" lazyload alt="image-20220814230414957"></p>
<p>常见的数据类型：根据业务的需求，业务数据的需求选择数据类型定义</p>
<p>INT：整数，unsigned：表示非负数</p>
<p>tinyint：0-128数字，2的8-1=7次方</p>
<p>float：浮点数</p>
<p>char：字符串，定长字符串</p>
<p>varchar：变长字符串</p>
<p>date、time：日期，时间</p>
<p>各种修饰符：空NULL，非空NOT NULL，DEFAULT默认值等</p>
<p>主键PK，唯一键UK等</p>
<p>AUTO_INCREMENT：定义数字自动增长</p>
<p><img src="https://img2022.cnblogs.com/blog/2792175/202208/2792175-20220828181326257-802938955.png" srcset="/img/loading.gif" lazyload alt="image-20220815212142133"></p>
<h3 id="char和varchar的区别"><a href="#char和varchar的区别" class="headerlink" title="char和varchar的区别"></a>char和varchar的区别</h3><p>char是定长，如果超过字符，则截断；存abcd，占4个字节，存abcdef，只能存到abcd</p>
<p>varchar：变长，存abcd，则存abcd，占5个字节</p>
<p>所以还是看业务数据类型的，比如定长数据，可以使用char(5)，如果是不确定的长度，还是用varchar好一点</p>
<h3 id="几种INT对比"><a href="#几种INT对比" class="headerlink" title="几种INT对比"></a>几种INT对比</h3><p>tinyint：占一个字节，也就是2的8次方个B，0-256数字</p>
<p>smallint：2个字节，可以放2的16次方=65536个数字</p>
<p>INT：占4个字节，2的32次方</p>
<h2 id="4-管理库表DDL"><a href="#4-管理库表DDL" class="headerlink" title="4.管理库表DDL"></a>4.管理库表DDL</h2><p>一个表在磁盘上就是一个数据库目录内的一个文件，需要到对应的数据库目录下才能看到，这里就是表文件</p>
<p><img src="2792175-20220828181326595-1757571807.png" srcset="/img/loading.gif" lazyload alt="image-20220815215816693"></p>
<h3 id="查看表show"><a href="#查看表show" class="headerlink" title="查看表show"></a>查看表show</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查询<br><span class="hljs-keyword">select</span> 字段 <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span><br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> xxx<br><span class="hljs-keyword">create</span> database xxx<br><br>##以竖行的形式显示所有表的信息状态，可以查看一些例如存储引擎，创建时间，字符集<span class="hljs-operator">+</span>排序规则等<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">table</span> status\G;<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>           Name: student<br>         Engine: InnoDB<br>        Version: <span class="hljs-number">10</span><br>     Row_format: <span class="hljs-keyword">Dynamic</span><br>           <span class="hljs-keyword">Rows</span>: <span class="hljs-number">0</span><br> Avg_row_length: <span class="hljs-number">0</span><br>    Data_length: <span class="hljs-number">16384</span><br>Max_data_length: <span class="hljs-number">0</span><br>   Index_length: <span class="hljs-number">0</span><br>      Data_free: <span class="hljs-number">0</span><br> Auto_increment: <span class="hljs-keyword">NULL</span><br>    Create_time: <span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-15</span> <span class="hljs-number">21</span>:<span class="hljs-number">47</span>:<span class="hljs-number">56</span><br>    Update_time: <span class="hljs-keyword">NULL</span><br>     Check_time: <span class="hljs-keyword">NULL</span><br>      <span class="hljs-keyword">Collation</span>: utf8mb4_0900_ai_ci<br>       Checksum: <span class="hljs-keyword">NULL</span><br> Create_options: <br>        Comment: <br></code></pre></td></tr></table></figure>

<h3 id="基本的创建表操作"><a href="#基本的创建表操作" class="headerlink" title="基本的创建表操作"></a>基本的创建表操作</h3><p>一般来说都是规定好表结构，字段数据类型等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">##管理表<br><span class="hljs-keyword">show</span> tables;<br><br>##删除表<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> catyer;<br><br>##创建一个学生表<br>##id字段tinyint0<span class="hljs-number">-256</span>数字，非负，非空，还是主键，自增长<br>##名字：字符<span class="hljs-number">4</span>个，非空<br>##性别：male <span class="hljs-keyword">or</span> female，<span class="hljs-number">6</span>个字符<br>##年龄：<span class="hljs-number">0</span><span class="hljs-number">-256</span>，非空<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student (<br>id tinyint unsigned <span class="hljs-keyword">primary</span> key auto_increment,<br>name <span class="hljs-type">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>sex <span class="hljs-type">char</span>(<span class="hljs-number">6</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age tinyint unsigned<br>);<br><br>##查看表结构：<span class="hljs-keyword">desc</span>，这个表有<span class="hljs-number">4</span>个字段，<span class="hljs-number">4</span>个域field，字段类型，是否为空，默认值是什么，EXTRA额外的属性：比如自增长 <br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">desc</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type             <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id    <span class="hljs-operator">|</span> tinyint unsigned <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">4</span>)          <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sex   <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">6</span>)          <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> age   <span class="hljs-operator">|</span> tinyint unsigned <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>AS：根据另一张表的查询结果创建目标表，等于将查询到的特定字段的值创建成了表，包括复制表结构和查询出来的数据</p>
<p>AS可以省略</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">##在catyer库内创建<span class="hljs-keyword">user</span>表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> mysql.user;<br>Query OK, <span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.01</span> sec)<br>Records: <span class="hljs-number">5</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br><br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p>LIKE：创建一个表结构一样的表，LIKE表没有数据，只有一样的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> user_like <span class="hljs-keyword">like</span> <span class="hljs-keyword">user</span>;<br>##两张表的表结构是一致的，HOST定义是<span class="hljs-number">255</span>个字符<br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">desc</span> <span class="hljs-keyword">user</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type      <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">32</span>)  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> host  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">255</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+------+-----+---------+-------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">desc</span> user_like;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type      <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+------+-----+---------+-------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">32</span>)  <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> host  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">255</span>) <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span>         <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-----------+------+-----+---------+-------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<h3 id="表、库重命名rename"><a href="#表、库重命名rename" class="headerlink" title="表、库重命名rename"></a>表、库重命名rename</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span>  <span class="hljs-keyword">TABLE</span> table_name RENAME <span class="hljs-keyword">TO</span> new_table_name<br><span class="hljs-keyword">ALTER</span>  <span class="hljs-keyword">TABLE</span> students RENAME <span class="hljs-keyword">TO</span> stu;<br><span class="hljs-keyword">ALTER</span>  database students RENAME <span class="hljs-keyword">TO</span> stu;<br></code></pre></td></tr></table></figure>

<h2 id="5-DML语句"><a href="#5-DML语句" class="headerlink" title="5.DML语句"></a>5.DML语句</h2><h3 id="insert插入语句"><a href="#insert插入语句" class="headerlink" title="insert插入语句"></a>insert插入语句</h3><p>一定要与表内的字段匹配，包括插入的顺序，可以先DESC一下表格，一般都是跑.sql的脚本</p>
<p>注意字符集：如果是latin，那仅仅只支持英文输入；如果是uft8mb4，则支持中文英文，是世界通用的字符集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">##基本语法<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> table_name;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">table</span>; <span class="hljs-keyword">into</span>可以省略<br><span class="hljs-keyword">desc</span> table_name;<br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">desc</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field <span class="hljs-operator">|</span> Type             <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> id    <span class="hljs-operator">|</span> tinyint unsigned <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> name  <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">4</span>)          <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> sex   <span class="hljs-operator">|</span> <span class="hljs-type">char</span>(<span class="hljs-number">6</span>)          <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> age   <span class="hljs-operator">|</span> tinyint unsigned <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##要和字段匹配，以及<span class="hljs-type">char</span>字符的限制，不能超过<span class="hljs-type">char</span>(<span class="hljs-number">4</span>)的限制<br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;cat&#x27;</span>,<span class="hljs-string">&#x27;M&#x27;</span>,<span class="hljs-string">&#x27;25&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>(root<span class="hljs-variable">@localhost</span>) [catyer]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> name <span class="hljs-operator">|</span> sex <span class="hljs-operator">|</span> age  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> cat  <span class="hljs-operator">|</span> M   <span class="hljs-operator">|</span>   <span class="hljs-number">25</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+------+-----+------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##批量导入，将查询结果导入，插入<br>##要求：表结构一致<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student1 <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student<br><span class="hljs-keyword">insert</span> student1 <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student;<br></code></pre></td></tr></table></figure>

<h3 id="有关自增长字段的用法，需要指明插入set的字段"><a href="#有关自增长字段的用法，需要指明插入set的字段" class="headerlink" title="有关自增长字段的用法，需要指明插入set的字段"></a>有关自增长字段的用法，需要指明插入set的字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">##在<span class="hljs-keyword">insert</span>这里需要在表中指明不添加id的字段，才可以实现id的自增，如果增加id字段，则需要写好id的值<br><span class="hljs-keyword">insert</span> student(name,sex,age) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;xiao&#x27;</span>,<span class="hljs-string">&#x27;male&#x27;</span>,<span class="hljs-number">20</span>);<br><span class="hljs-operator">&gt;</span> Affected <span class="hljs-keyword">rows</span>: <span class="hljs-number">1</span><br><span class="hljs-operator">&gt;</span> 时间: <span class="hljs-number">0.003</span>s<br><br>##如果在<span class="hljs-keyword">insert</span>中不指定字段，则<span class="hljs-keyword">VALUES</span>默认插入所有，不写ID的值就会报错<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test (id auto_increment)<br></code></pre></td></tr></table></figure>

<p>update语句：修改语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">##修改学生的年龄<br><span class="hljs-keyword">update</span> table_name <span class="hljs-keyword">set</span> 字段名 <span class="hljs-keyword">where</span>(条件判断，一般是id)<br>##<span class="hljs-keyword">update</span><br><span class="hljs-keyword">update</span> student <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">30</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>

<p>delete语句：删除语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">##<span class="hljs-keyword">delete</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">4</span>;<br></code></pre></td></tr></table></figure>

<h3 id="truncate：清空表，同时释放磁盘空间—-gt-非常危险，慎用"><a href="#truncate：清空表，同时释放磁盘空间—-gt-非常危险，慎用" class="headerlink" title="truncate：清空表，同时释放磁盘空间—&gt;非常危险，慎用"></a>truncate：清空表，同时释放磁盘空间—&gt;非常危险，慎用</h3><p>保留表结果，高危指令，同时也会释放磁盘空间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">truncate</span> <span class="hljs-keyword">table</span> test;<br><br>##执行一个.<span class="hljs-keyword">sql</span>插入<span class="hljs-number">10</span>w条记录的脚本<br>##创建一个表，id自增主键，名字<span class="hljs-number">10</span>个字符，工资默认<span class="hljs-number">20</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> testlog (id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,name <span class="hljs-type">char</span>(<span class="hljs-number">10</span>),salary <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">20</span>);<br><br>##声明一个函数<br>delimiter $$<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span>  sp_testlog() <br><span class="hljs-keyword">begin</span>  <br><span class="hljs-keyword">declare</span> i <span class="hljs-type">int</span>;<br><span class="hljs-keyword">set</span> i <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <br>while i <span class="hljs-operator">&lt;=</span> <span class="hljs-number">100000</span> <br>do  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testlog(name,salary) <span class="hljs-keyword">values</span> (concat(<span class="hljs-string">&#x27;wang&#x27;</span>,<span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">100000</span>)),<span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">1000000</span>)); <br><span class="hljs-keyword">set</span> i <span class="hljs-operator">=</span> i <span class="hljs-operator">+</span><span class="hljs-number">1</span>; <br><span class="hljs-keyword">end</span> while; <br><span class="hljs-keyword">end</span>$$<br><br>delimiter ;<br><br>##执行函数，用了<span class="hljs-number">49</span>s<br><span class="hljs-keyword">call</span> sp_testlog;<br><span class="hljs-keyword">CALL</span> sp_testlog;<br><span class="hljs-operator">&gt;</span> OK<br><span class="hljs-operator">&gt;</span> 时间: <span class="hljs-number">49.073</span>s<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181326910-2059997911.png" srcset="/img/loading.gif" lazyload alt="image-20220817231343943"></p>
<p>使用truncate实验，清空表数据，同时释放磁盘空间，不常用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">truncate table testlog<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181327232-1719226667.png" srcset="/img/loading.gif" lazyload alt="image-20220817231521851"></p>
<h2 id="6-DQL语句：单表查询-重点掌握"><a href="#6-DQL语句：单表查询-重点掌握" class="headerlink" title="6.DQL语句：单表查询(重点掌握)"></a>6.DQL语句：单表查询(重点掌握)</h2><p>一般DML语句都是修改的，通过.sql脚本进行增删查改，或者是项目之初建库的时候，直接执行.sql的语句进行批量业务数据的插入</p>
<p>其实SQL的查询语句就类似英文句子</p>
<p>单表查询</p>
<p>count(*)：只显示有值的，NULL空是没有的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查询对应的列(域field)<br><span class="hljs-keyword">select</span> Name,Age <span class="hljs-keyword">from</span> students;<br><br>##给输出的字段加别名，可以不这么用<br><span class="hljs-keyword">select</span> name 姓名 <span class="hljs-keyword">from</span> students;<br><br>##查询表内一共有多少条记录：<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)，有<span class="hljs-number">25</span>条，只显示有值的，如果为<span class="hljs-keyword">NULL</span>则没有<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> students;<br><br>##空或者非空，存在或者非存在<br><span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">NULL</span><br>exist<br><span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> exist<br></code></pre></td></tr></table></figure>

<p>select+where查询</p>
<p>limit：可以限制首页可以查看多少条记录，过了就要翻下一页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">##精确查询到某一行，<span class="hljs-keyword">and</span>并列<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span><span class="hljs-number">20</span> <span class="hljs-keyword">and</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;F&#x27;</span>;<br><br>##<span class="hljs-keyword">or</span>或者<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span><span class="hljs-number">20</span> <span class="hljs-keyword">or</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;F&#x27;</span>;<br><br>##相同列不同的取数，同一列不同值<br>从<span class="hljs-number">1</span>班和<span class="hljs-number">3</span>班中挑出女生<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> classid <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">3</span>) <span class="hljs-keyword">and</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;M&#x27;</span>;<br><br>##<span class="hljs-keyword">between</span>之间<br><span class="hljs-number">1</span>班和<span class="hljs-number">3</span>班中取出年龄在<span class="hljs-number">20</span><span class="hljs-number">-30</span>岁的学生<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> classid <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">3</span>) <span class="hljs-keyword">and</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure>

<h3 id="select-limit-限制查看的条目数"><a href="#select-limit-限制查看的条目数" class="headerlink" title="select limit 限制查看的条目数"></a>select limit 限制查看的条目数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">##直接看前<span class="hljs-number">3</span>条记录<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students limit <span class="hljs-number">3</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students limit <span class="hljs-number">10</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">desc</span> limit <span class="hljs-number">5</span>;<br><span class="hljs-number">25</span>	Sun Dasheng	<span class="hljs-number">100</span>	M		<br><span class="hljs-number">3</span>	Xie Yanke	<span class="hljs-number">53</span>	M	<span class="hljs-number">2</span>	<span class="hljs-number">16</span><br><span class="hljs-number">6</span>	Shi Qing	<span class="hljs-number">46</span>	M	<span class="hljs-number">5</span>	<br><span class="hljs-number">13</span>	Tian Boguang	<span class="hljs-number">33</span>	M	<span class="hljs-number">2</span>	<br><span class="hljs-number">4</span>	Ding Dian	<span class="hljs-number">32</span>	M	<span class="hljs-number">4</span>	<span class="hljs-number">4</span><br><br>##limit跳过前<span class="hljs-number">3</span>行，从第<span class="hljs-number">4</span>行开始显示<span class="hljs-number">6</span>行<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students limit <span class="hljs-number">3</span>,<span class="hljs-number">6</span>;<br><span class="hljs-number">4</span>	Ding Dian	<span class="hljs-number">32</span>	M	<span class="hljs-number">4</span>	<span class="hljs-number">4</span><br><span class="hljs-number">5</span>	Yu Yutong	<span class="hljs-number">26</span>	M	<span class="hljs-number">3</span>	<span class="hljs-number">1</span><br><span class="hljs-number">6</span>	Shi Qing	<span class="hljs-number">46</span>	M	<span class="hljs-number">5</span>	<br><span class="hljs-number">7</span>	Xi Ren	<span class="hljs-number">19</span>	F	<span class="hljs-number">3</span>	<br><span class="hljs-number">8</span>	Lin Daiyu	<span class="hljs-number">17</span>	F	<span class="hljs-number">7</span>	<br><span class="hljs-number">9</span>	Ren Yingying	<span class="hljs-number">20</span>	F	<span class="hljs-number">6</span>	<br></code></pre></td></tr></table></figure>

<p>where判断是否为空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs none">select * from students where classid is null;<br>select * from students where classid is not null;<br></code></pre></td></tr></table></figure>

<p>模糊查询like</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查询以name ma开头的记录<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> &quot;%ma%&quot;;<br><br>##查询包含姓名内包含x的记录，可以作为在网站内查询某个商品，一般都是模糊查询，比如我要查罗技，但是这个品牌下有很多记录，会显示所有的模糊查询记录，然后按照一定顺序(比如说购买量)显示出来<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> &quot;%x%&quot;;<br></code></pre></td></tr></table></figure>

<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">##统计平均年龄，总数<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> students;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> students;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(age) <span class="hljs-keyword">from</span> students;<br><br>##男生女生中年龄最大的，以性别分组<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> students <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender;<br></code></pre></td></tr></table></figure>

<p>sql注入攻击</p>
<p>绕过数据库的安全监测，导致黑客成功登录到网站的后台/网站的数据库，从而窃取数据；利用数据库的user&amp;password的漏洞</p>
<h3 id="select-group-by分组统计"><a href="#select-group-by分组统计" class="headerlink" title="select group by分组统计"></a>select group by分组统计</h3><p>group by语法：如果使用了group by的写法，前面select的字段就只能是group by的条件字段，或者是聚合函数</p>
<p>不是group by的东西</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">##<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>分组统计，按照性别<br><span class="hljs-keyword">select</span> gender,<span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> students <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender;<br>M	<span class="hljs-number">33.0000</span><br>F	<span class="hljs-number">19.0000</span><br><br>##添加多一个字段，就报错<br><span class="hljs-keyword">select</span> gender,<span class="hljs-built_in">avg</span>(age),stuid <span class="hljs-keyword">from</span> students <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender<br><span class="hljs-operator">&gt;</span> <span class="hljs-number">1055</span> <span class="hljs-operator">-</span> Expression <br>#<span class="hljs-number">3</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">SELECT</span> list <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> clause <span class="hljs-keyword">and</span> <span class="hljs-keyword">contains</span> nonaggregated <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;hellodb.students.StuID&#x27;</span> which <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> functionally dependent <span class="hljs-keyword">on</span> columns <span class="hljs-keyword">in</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> clause; this <span class="hljs-keyword">is</span> incompatible <span class="hljs-keyword">with</span> sql_mode<span class="hljs-operator">=</span>only_full_group_by<br><br>##<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>后继续过滤条件：<span class="hljs-keyword">having</span>或者是<span class="hljs-keyword">where</span>，两种写法；<span class="hljs-keyword">from</span>后面加<span class="hljs-keyword">where</span>过滤条件，或者是<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>后面加<span class="hljs-keyword">having</span><br><span class="hljs-keyword">select</span> gender,<span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> students <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender;<br>M	<span class="hljs-number">33.0000</span><br>F	<span class="hljs-number">19.0000</span><br><br><span class="hljs-keyword">select</span> gender,<span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;F&#x27;</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender; <br><span class="hljs-keyword">select</span> gender,<span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> students <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender <span class="hljs-keyword">having</span> gender<span class="hljs-operator">=</span><span class="hljs-string">&#x27;M&#x27;</span>;<br><br>##多个字段<span class="hljs-keyword">Group</span> <span class="hljs-keyword">by</span>，过滤掉空行<br><span class="hljs-keyword">select</span> ClassID,gender,<span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> students  <span class="hljs-keyword">WHERE</span> ClassID <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender,ClassID;<br></code></pre></td></tr></table></figure>

<h3 id="select-order-by排序"><a href="#select-order-by排序" class="headerlink" title="select order by排序"></a>select order by排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">##正序倒序排序，正序从小到大，倒序从大到小，类似sort，sort默认由小到大，sort <span class="hljs-operator">-</span>r从大到小<br>##排序<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>

<h2 id="7-SQL多表查询-重点掌握"><a href="#7-SQL多表查询-重点掌握" class="headerlink" title="7.SQL多表查询(重点掌握)"></a>7.SQL多表查询(重点掌握)</h2><p><img src="2792175-20220828181327734-407844475.png" srcset="/img/loading.gif" lazyload alt="image-20220820112949822"></p>
<h3 id="子查询：嵌套SQL语句"><a href="#子查询：嵌套SQL语句" class="headerlink" title="子查询：嵌套SQL语句"></a>子查询：嵌套SQL语句</h3><p>SQL语句中嵌套了别的查询结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">##子查询，实现修改老师年龄为学生最大年龄<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> students;<br><span class="hljs-keyword">update</span> teachers <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> students) <span class="hljs-keyword">where</span> tid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-number">1</span>	Song Jiang	<span class="hljs-number">100</span>	M<br><span class="hljs-number">2</span>	Zhang Sanfeng	<span class="hljs-number">94</span>	M<br><span class="hljs-number">3</span>	Miejue Shitai	<span class="hljs-number">77</span>	F<br><span class="hljs-number">4</span>	Lin Chaoying	<span class="hljs-number">93</span>	F<br><br>##子查询作为条件<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> teachers <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span>(<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> students);<br></code></pre></td></tr></table></figure>

<h3 id="联合查询union-字段数量相同"><a href="#联合查询union-字段数量相同" class="headerlink" title="联合查询union(字段数量相同)"></a>联合查询union(字段数量相同)</h3><p>将多张表合并成一张表，联合查询这个大表</p>
<p>需要相同字段数量，不能字段数量不统一，最好是字段的数据类型类似或者相同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">##联合查询，凡是查询都可以加别名<br><span class="hljs-keyword">select</span> stuid,name,age,gender <span class="hljs-keyword">from</span> students <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> teachers;<br><span class="hljs-keyword">select</span> stuid ID,name 姓名,age 年龄,gender 性别 <span class="hljs-keyword">from</span> students <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> teachers; <br><span class="hljs-number">1</span>	Shi Zhongyu	<span class="hljs-number">22</span>	M<br><span class="hljs-number">2</span>	Shi Potian	<span class="hljs-number">22</span>	M<br><span class="hljs-number">3</span>	Xie Yanke	<span class="hljs-number">53</span>	M<br><span class="hljs-number">4</span>	Ding Dian	<span class="hljs-number">32</span>	M<br><span class="hljs-number">5</span>	Yu Yutong	<span class="hljs-number">26</span>	M<br><span class="hljs-number">6</span>	Shi Qing	<span class="hljs-number">46</span>	M<br><span class="hljs-number">7</span>	Xi Ren	<span class="hljs-number">19</span>	F<br><span class="hljs-number">8</span>	Lin Daiyu	<span class="hljs-number">17</span>	F<br><span class="hljs-number">9</span>	Ren Yingying	<span class="hljs-number">20</span>	F<br><span class="hljs-number">10</span>	Yue Lingshan	<span class="hljs-number">19</span>	F<br></code></pre></td></tr></table></figure>

<p>横向合并，交叉连接cross join，乘积算法，不常用，因为出来的结果太大了</p>
<p>表1：学生表，25条记录</p>
<p>表2：老师表，4条记录，老师表和学生表逐一组合，形成4*25=100条记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs none">##cross join<br>select * from students cross join teachers;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181328161-275014696.png" srcset="/img/loading.gif" lazyload alt="image-20220820110133835"></p>
<h3 id="内连接inner-join：交集"><a href="#内连接inner-join：交集" class="headerlink" title="内连接inner join：交集"></a>内连接inner join：交集</h3><p><img src="2792175-20220828181328429-1476079978.png" srcset="/img/loading.gif" lazyload alt="image-20220820113418419"></p>
<p>前提：两张表最好有类似的字段，一样的数据，不然无法筛选的</p>
<p>取两张表的相同字段的值，也可以指定查询的字段，显示出来，可以给查询的表写别名来区分不同的表的字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">##案例：学生表和老师表共同在于teacherid和tid有相同的<br><span class="hljs-number">1.</span>先列出需要查询显示的字段，students s teachers t，可用这样的表示法来写明哪张表<br><span class="hljs-number">2.</span><span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span>内连接<br><span class="hljs-number">3.</span><span class="hljs-keyword">on</span> 条件判断相等<br><span class="hljs-keyword">select</span> s.StuID,s.name,s.TeacherID,t.name,t.tid <span class="hljs-keyword">from</span> students s <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> teachers t <span class="hljs-keyword">on</span> s.TeacherID<span class="hljs-operator">=</span>t.TID;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181328721-1704275971.png" srcset="/img/loading.gif" lazyload alt="image-20220820110111770"></p>
<p>inner join相同条件的记录数只有3条</p>
<p>多次取内连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">##成绩表<br>##显示学生成绩<br><span class="hljs-keyword">select</span> s.stuid,s.name,sc.CourseID,sc.Score <span class="hljs-keyword">from</span> scores sc <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> students s <span class="hljs-keyword">on</span> sc.StuID<span class="hljs-operator">=</span>s.StuID;<br><br>##三张表内连接取相同字段，在前面用<span class="hljs-keyword">select</span>显示需要查询的字段，能显示出课程名称<br>##显示学生id，姓名(student)，课程名(course)，分数(score)<br><span class="hljs-keyword">select</span> st.stuid,st.name,co.Course,sc.Score <span class="hljs-keyword">from</span> scores sc <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> students st <span class="hljs-keyword">on</span> sc.StuID<span class="hljs-operator">=</span>st.StuID <span class="hljs-keyword">inner</span> <span class="hljs-keyword">JOIN</span> courses co <span class="hljs-keyword">on</span> sc.CourseID<span class="hljs-operator">=</span>co.CourseID;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181328963-633085938.png" srcset="/img/loading.gif" lazyload alt="image-20220820114610272"></p>
<p><img src="2792175-20220828181329284-844691555.png" srcset="/img/loading.gif" lazyload alt="image-20220820115317553"></p>
<h3 id="左外连接和右外连接：left-join"><a href="#左外连接和右外连接：left-join" class="headerlink" title="左外连接和右外连接：left join"></a>左外连接和右外连接：left join</h3><p><img src="2792175-20220828181329559-1210890777.png" srcset="/img/loading.gif" lazyload alt="image-20220820113427740"></p>
<p>保存左表(右表)的全部数据，条件on写对应两张表的条件，如果查询的左表(右表)记录数不符合，则填NULL代替；兼顾不同边</p>
<p>为什么right join老师表只有4条记录，有一条为空？—&gt;因为有一个teacher ID对不上t ID，所以为NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">##<span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span><br>##因为stu有<span class="hljs-number">25</span>条记录，teacher有<span class="hljs-number">4</span>条记录，所以除了ID对应好的那几条，其余的teacher表都为<span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students s <span class="hljs-keyword">left</span> <span class="hljs-keyword">JOIN</span> teachers t <span class="hljs-keyword">on</span> s.TeacherID<span class="hljs-operator">=</span>t.TID;<br><br>##<span class="hljs-keyword">right</span> <span class="hljs-keyword">join</span><br>##因为stu有<span class="hljs-number">25</span>条记录，teacher有<span class="hljs-number">4</span>条记录，所以除了ID对应好的那几条，其余的stu表都为<span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students s <span class="hljs-keyword">right</span> <span class="hljs-keyword">JOIN</span> teachers t <span class="hljs-keyword">on</span> s.TeacherID<span class="hljs-operator">=</span>t.TID;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181329880-1121404312.png" srcset="/img/loading.gif" lazyload alt="image-20220820112036307"></p>
<p><img src="2792175-20220828181330175-1042091537.png" srcset="/img/loading.gif" lazyload alt="image-20220820112051634"></p>
<p>左外连接和右外连接取反：去掉对应条件，想想交集和并集就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs none">##left join取反<br>select * from students s left JOIN teachers t on s.TeacherID=t.TID where t.TID is null;<br><br>##right join取反<br>select * from students s right JOIN teachers t on s.TeacherID=t.TID;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181330454-709513067.png" srcset="/img/loading.gif" lazyload alt="image-20220820113103772"></p>
<p>完全外连接：左连接+union+右连接，可以去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">##完全外连接，结合左外连接<span class="hljs-operator">+</span>右外连接，去重<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students s <span class="hljs-keyword">left</span> <span class="hljs-keyword">JOIN</span> teachers t <span class="hljs-keyword">on</span> s.TeacherID<span class="hljs-operator">=</span>t.TID<br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students s <span class="hljs-keyword">right</span> <span class="hljs-keyword">JOIN</span> teachers t <span class="hljs-keyword">on</span> s.TeacherID<span class="hljs-operator">=</span>t.TID;<br></code></pre></td></tr></table></figure>

<h3 id="自连接：自己表连接自己，筛选记录"><a href="#自连接：自己表连接自己，筛选记录" class="headerlink" title="自连接：自己表连接自己，筛选记录"></a>自连接：自己表连接自己，筛选记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp (id <span class="hljs-type">int</span>,empname <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>),leaderid <span class="hljs-type">int</span>);<br><span class="hljs-keyword">desc</span> emp;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;magedu&#x27;</span>,<span class="hljs-keyword">null</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;wang&#x27;</span>,<span class="hljs-number">1</span>),(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;zhang&#x27;</span>,<span class="hljs-number">2</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp;<br><span class="hljs-number">1</span>	magedu	<br><span class="hljs-number">2</span>	wang	<span class="hljs-number">1</span><br><span class="hljs-number">3</span>	zhang	<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<p>需求：查询每个人对应领导的名字，ID</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">##自己的表也可以配置两个别名<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> emp l <span class="hljs-keyword">on</span> e.id<span class="hljs-operator">=</span>l.leaderid<br><br>##自己的表也可以配置两个别名，跳出对应的列<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> emp l <span class="hljs-keyword">on</span> e.id<span class="hljs-operator">=</span>l.leaderid<br><br>##ifnull空函数，逻辑是员工表的领导ID<span class="hljs-operator">=</span>领导表他们自己的ID，先对应领导<br>##<span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span>左连接，显示左表所有的值，如果是<span class="hljs-keyword">Inner</span> <span class="hljs-keyword">join</span>，则是显示一定有的，magedu就没了，不是交集，因为magedu没有leaderid<br><span class="hljs-keyword">select</span> e.name 员工姓名,IFNULL(l.name,<span class="hljs-string">&#x27;大boss&#x27;</span>) 领导姓名 <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> emp l <span class="hljs-keyword">on</span> e.leaderid<span class="hljs-operator">=</span>l.id<br></code></pre></td></tr></table></figure>

<p><img src="https://img2022.cnblogs.com/blog/2792175/202208/2792175-20220828181330720-1533465976.png" srcset="/img/loading.gif" lazyload alt="image-20220820123128348"></p>
<h1 id="有关MySQL数据库的其他功能过程"><a href="#有关MySQL数据库的其他功能过程" class="headerlink" title="有关MySQL数据库的其他功能过程"></a>有关MySQL数据库的其他功能过程</h1><h2 id="1-视图view"><a href="#1-视图view" class="headerlink" title="1.视图view"></a>1.视图view</h2><p>功能作用：类似表，可以将一段查询语句的结果当做一个view来执行，后续可以查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">##创建视图<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">view</span> v_leader <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> e.name 员工姓名,IFNULL(l.name,<span class="hljs-string">&#x27;大boss&#x27;</span>) 领导姓名 <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> emp l <span class="hljs-keyword">on</span> e.leaderid<span class="hljs-operator">=</span>l.id<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> v_leader;<br><br>##删除视图<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">view</span> v_leader;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181330998-1234739629.png" srcset="/img/loading.gif" lazyload alt="image-20220820162205130"></p>
<h2 id="2-存储过程procedure"><a href="#2-存储过程procedure" class="headerlink" title="2.存储过程procedure"></a>2.存储过程procedure</h2><p>类似脚本，主要是可以将进入到数据库内的操作先写成一系列的操作，是.sql的脚本，比如建库建表，插入数据等等，可以写类似while循环</p>
<p>里面类似function函数，声明一个变量i，每条语句都要加分号</p>
<p>结束符使用$$或者//都行，自定义的结束符，可以生成随机数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">##创建表，生成<span class="hljs-number">10</span>w条记录<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> exist testlog (id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key,name <span class="hljs-type">char</span>(<span class="hljs-number">10</span>),salary <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">20</span>);<br><br>delimiter $$ ##定义结束符<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span>  sp_testlog() <br><span class="hljs-keyword">begin</span>  <br><span class="hljs-keyword">declare</span> i <span class="hljs-type">int</span>;<br><span class="hljs-keyword">set</span> i <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <br>while i <span class="hljs-operator">&lt;=</span> <span class="hljs-number">100000</span> <br>do  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> testlog(name,salary) <span class="hljs-keyword">values</span> (concat(<span class="hljs-string">&#x27;wang&#x27;</span>,<span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">100000</span>)),<span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">1000000</span>)); <br><span class="hljs-keyword">set</span> i <span class="hljs-operator">=</span> i <span class="hljs-operator">+</span><span class="hljs-number">1</span>; <br><span class="hljs-keyword">end</span> while; <br><span class="hljs-keyword">end</span>$$<br><br>delimiter ;<br><br>##执行存储过程<br><span class="hljs-keyword">call</span> sp_testlog;<br><br>##查看表的记录<br><span class="hljs-keyword">show</span> tables;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> testlog;	<br><br>##查看库内的存储过程<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">procedure</span> status \G;<br></code></pre></td></tr></table></figure>

<h2 id="3-trigger触发器"><a href="#3-trigger触发器" class="headerlink" title="3.trigger触发器"></a>3.trigger触发器</h2><p>定义：当某个事件触发的时候(insert加数据，delete删除数据)，自动修改表内的数目，称为触发器trigger</p>
<p>注意：需要先在count表内归0，不然里面默认是NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql">###创建表<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">table</span> student_info(<br>stu_id <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">PRIMARY</span> key auto_increment ,<br>stu_name <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">null</span><br>);<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">table</span> stu_count(<br>stu_count <span class="hljs-type">int</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span><br>);<br><br>##查看测试表<br><span class="hljs-keyword">show</span> tables;<br><br>##创建<span class="hljs-keyword">trigger</span>，加减的触发器，每新加一条记录(<span class="hljs-keyword">each</span> <span class="hljs-type">row</span>)，count就会<span class="hljs-operator">+</span><span class="hljs-number">1</span>；每减少一条记录，count就会<span class="hljs-number">-1</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> trigger_incre<br>after <span class="hljs-keyword">insert</span><br><span class="hljs-keyword">on</span> student_info <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span><br><span class="hljs-keyword">update</span> stu_count <span class="hljs-keyword">set</span> stu_count<span class="hljs-operator">=</span>stu_count<span class="hljs-operator">+</span><span class="hljs-number">1</span>;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> trigger_decre<br>after <span class="hljs-keyword">delete</span> <br><span class="hljs-keyword">on</span> student_info <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-type">row</span><br><span class="hljs-keyword">update</span> stu_count <span class="hljs-keyword">set</span> stu_count<span class="hljs-operator">=</span>stu_count<span class="hljs-number">-1</span>;<br><br>##查看库内的触发器个数<br><span class="hljs-keyword">show</span> triggers;<br><br>##查询表内的内容，也可以写存储过程批量化的插入表记录<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student_info;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> stu_count;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student_info <span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;mary&#x27;</span>)，(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;mary&#x27;</span>)，(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;mary&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> stu_count <span class="hljs-keyword">values</span>(<span class="hljs-number">0</span>);<br><br>##<span class="hljs-keyword">delete</span>，会自动减少count的值.<span class="hljs-keyword">where</span>查询后<span class="hljs-keyword">delete</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student_info <span class="hljs-keyword">where</span> stu_id<span class="hljs-operator">&gt;=</span><span class="hljs-number">2</span>;<br><br>##清空表<br><span class="hljs-keyword">truncate</span> stu_count;<br><span class="hljs-keyword">truncate</span> student_info;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181331259-1724389273.png" srcset="/img/loading.gif" lazyload alt="image-20220820170205345"></p>
<h2 id="4-EVENT事件—计划任务"><a href="#4-EVENT事件—计划任务" class="headerlink" title="4.EVENT事件—计划任务"></a>4.EVENT事件—计划任务</h2><p>show variables like event-schduler</p>
<p>可以定时执行对应的任务操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">##开启event事件调度，定时执行任务<br><span class="hljs-keyword">select</span> @<span class="hljs-variable">@event</span>_scheduler; <span class="hljs-keyword">ON</span><br><span class="hljs-keyword">show</span> processlist;<br></code></pre></td></tr></table></figure>

<h1 id="MySQL用户管理权限"><a href="#MySQL用户管理权限" class="headerlink" title="MySQL用户管理权限"></a>MySQL用户管理权限</h1><p>系统默认账户，可以新创建用户，指定某些IP段可以访问</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">[mysql]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123&#x27;</span>;<br>flush privileges;<br></code></pre></td></tr></table></figure>

<h2 id="在MySQL的skip-grant-tables下修改密码"><a href="#在MySQL的skip-grant-tables下修改密码" class="headerlink" title="在MySQL的skip-grant-tables下修改密码"></a>在MySQL的skip-grant-tables下修改密码</h2><p>当忘记了MySQL的密码后，需要在my.cnf的[mysqld]上面添加一个skip-grant-tables来跳过密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs none">vim /etc/my.cnf<br>#skip-grant-tables<br>systemctl restart mysqld<br></code></pre></td></tr></table></figure>

<p>进入到数据库后，发现更改密码的操作无法执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs none">(root@localhost) [(none)]&gt;alter user root@&#x27;localhost&#x27; identified by &#x27;123&#x27;;<br>ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement<br></code></pre></td></tr></table></figure>

<p>需要直接去更改表操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql">##之前的报错<br><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> authentication_string<span class="hljs-operator">=</span>password<span class="hljs-string">&#x27;123456&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span>;<br>ERROR <span class="hljs-number">1064</span> (<span class="hljs-number">42000</span>): You have an error <span class="hljs-keyword">in</span> your <span class="hljs-keyword">SQL</span> syntax; <span class="hljs-keyword">check</span> the manual that corresponds <span class="hljs-keyword">to</span> your MySQL server version <span class="hljs-keyword">for</span> the <span class="hljs-keyword">right</span> syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-number">123456</span><span class="hljs-string">&#x27; where user=&#x27;</span>root<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">at</span> line <span class="hljs-number">1</span><br><br><span class="hljs-comment">---&gt;这个其实是mysql8.0之前的写法，后续8.0不使用=password这样的写法了</span><br><br><br>##查询一下这个表的东西，可以看到，不同的<span class="hljs-keyword">user</span><span class="hljs-variable">@host</span>的密码是不同的；如果需要改root要先区分好改哪个root，是本地root还是远程root<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host,authentication_string <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+------------------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span> authentication_string                                                  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-----------+------------------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span> $A$<span class="hljs-number">005</span>$G]@&quot;&gt;|wLG%Oe3PK61VSgxpemuc0kWZZt87GwaA0XbsKK1M4DumIT8rKijO2 |<br>| catyer           | 10.0.0.%  | *23AE809DDACAF96AF0FD78ED04B6A265E05AA257                              |<br>| mysql.infoschema | localhost | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |<br>| mysql.session    | localhost | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |<br>| mysql.sys        | localhost | $A$005$THISISACOMBINATIONOFINVALIDSALTANDPASSWORDTHATMUSTNEVERBRBEUSED |<br><br>##mysql8.0修改默认密码<br>1.设置为空<br>update user set authentication_string=&#x27;&#x27; where user=root<br><br>2.将配置文件内的skip注释掉，重启服务<br>vim /etc/my.cnf<br>#skip-grant-tables<br>systemctl restart mysqld<br><br>3.使用空密码登录到DB<br>mysql<br><br>4.修改本地用户密码<br>alter user root@&#x27;localhost&#x27; identified by &#x27;123&#x27;;<br>flush privileges;<br><br>5.登录<br>mysql -uroot -p123<br></code></pre></td></tr></table></figure>

<h2 id="解决MySQL8-0无法使用远程登录的问题caching-sha2-password"><a href="#解决MySQL8-0无法使用远程登录的问题caching-sha2-password" class="headerlink" title="解决MySQL8.0无法使用远程登录的问题caching_sha2_password"></a>解决MySQL8.0无法使用远程登录的问题caching_sha2_password</h2><p>在创建好一个用户后，因为MySQL8.0默认的密码策略，导致我们一时间没法直接连接，出现这个报错</p>
<p><img src="2792175-20220828181331530-961936863.png" srcset="/img/loading.gif" lazyload alt="image-20220821081454735"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs none">ERROR 2059 (HY000): Authentication plugin &#x27;caching_sha2_password&#x27; cannot be loaded: /usr/lib64/mysql/plugin/caching_sha2_password.so: cannot open shared object file: No such file or directory<br></code></pre></td></tr></table></figure>

<p>原因就在于：8.0默认使用的认证方式是caching_sha2_password，我们设置的密码过于简单，实验环境下，需要在指定给远程用户的时候写上</p>
<p>在8.0以前(5.7、5.6等)，都是mysql_native_password这个参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> <br><br>##查看默认的认证插件<br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;default_authentication_plugin&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-----------------------+</span><br><span class="hljs-operator">|</span> Variable_name                 <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-----------------------+</span><br><span class="hljs-operator">|</span> default_authentication_plugin <span class="hljs-operator">|</span> caching_sha2_password <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##最佳做法：可以在赋予密码的时候，加上mysql_native_password，记住这种写法，需要设置简单密码的时候，能不改全局尽量不改全局<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password  <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123&#x27;</span>;<br>flush privileges;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;wpuser&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123&#x27;</span>;<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> wordpress.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;wpuser&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">grant</span> option;<br><br>##登录尝试成功<br>mysql <span class="hljs-operator">-</span>ucatyer <span class="hljs-operator">-</span>p123 <span class="hljs-operator">-</span>h10<span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.132</span><br>Warning: <span class="hljs-keyword">Using</span> a password <span class="hljs-keyword">on</span> the command line interface can be insecure.<br>Welcome <span class="hljs-keyword">to</span> the MySQL monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> \g.<br>Your MySQL connection id <span class="hljs-keyword">is</span> <span class="hljs-number">9</span><br>Server version: <span class="hljs-number">8.0</span><span class="hljs-number">.30</span> MySQL Community Server <span class="hljs-operator">-</span> GPL<br></code></pre></td></tr></table></figure>

<h2 id="MySQL用户业务数据库授权"><a href="#MySQL用户业务数据库授权" class="headerlink" title="MySQL用户业务数据库授权"></a>MySQL用户业务数据库授权</h2><p>授权某个库的管理员操作权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql">##先看下每个用户的权限<br>Grant_priv：具有授权的权限<br>Super_priv：拥有超级权限<br><br><span class="hljs-keyword">SELECT</span> host,<span class="hljs-keyword">user</span>,Grant_priv,Super_priv <span class="hljs-keyword">FROM</span> mysql.user;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+------------+------------+</span><br><span class="hljs-operator">|</span> host      <span class="hljs-operator">|</span> <span class="hljs-keyword">user</span>             <span class="hljs-operator">|</span> Grant_priv <span class="hljs-operator">|</span> Super_priv <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+------------+------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-operator">%</span>         <span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> Y          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">10.0</span><span class="hljs-number">.0</span>.<span class="hljs-operator">%</span>  <span class="hljs-operator">|</span> catyer           <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.infoschema <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.session    <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> Y          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> mysql.sys        <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> root             <span class="hljs-operator">|</span> Y          <span class="hljs-operator">|</span> Y          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+------------+------------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##授权操作，还得是本地localhost用户来，Navicat是远程用户，不具备授权能力<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> zabbix.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br>flush privileges;<br><br><span class="hljs-keyword">grant</span> (操作权限:<span class="hljs-keyword">insert</span>,<span class="hljs-keyword">create</span>,delete...) <span class="hljs-keyword">on</span> db.table_name <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;user&#x27;</span>@<span class="hljs-string">&#x27;host&#x27;</span><br><br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> hellodb(代表哪个库).<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> hellodb.students <span class="hljs-keyword">to</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>; ##授权只能访问修改这个表，可以给别的开发使用，细粒度的授权<br><span class="hljs-keyword">show</span> tables;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-operator">|</span> Tables_in_hellodb <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-operator">|</span> students          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##授权远程用户有授权能力，可以在navicat内编辑<br><span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> Grant_priv<span class="hljs-operator">=</span><span class="hljs-string">&#x27;Y&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="revoke回收权限"><a href="#revoke回收权限" class="headerlink" title="revoke回收权限"></a>revoke回收权限</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查看catyer这个用户的权限<br><span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;catyer&#x27;</span>@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------------+</span><br><span class="hljs-operator">|</span> Grants <span class="hljs-keyword">for</span> catyer<span class="hljs-variable">@10</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>.<span class="hljs-operator">%</span>                                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `catyer`@`<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>.<span class="hljs-operator">%</span>`                 <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> `zabbix`.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> `catyer`@`<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>.<span class="hljs-operator">%</span>` <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------------+</span><br><br>##回收删除权限<br><span class="hljs-keyword">revoke</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">on</span> hellodb.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br>flush privileges;<br><br>##回收所有权限<br><span class="hljs-keyword">revoke</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> hellodb.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> catyer@<span class="hljs-string">&#x27;10.0.0.%&#x27;</span>;<br>flush privileges;<br></code></pre></td></tr></table></figure>

<h1 id="MySQL的基本架构和优化"><a href="#MySQL的基本架构和优化" class="headerlink" title="MySQL的基本架构和优化"></a>MySQL的基本架构和优化</h1><p><img src="2792175-20220828181331965-1341432725.png" srcset="/img/loading.gif" lazyload alt="image-20220825220957657"></p>
<p>基本的MySQL架构</p>
<p>1.连接器connectors：负责给到各种程序进行对接，连接，例如C，JAVA(JDBC，JAVA OPEN DATABASE CONNECTION)，ODBC(Oracle database connection等)，.net等windows的程序</p>
<p>2.连接池，会做各种的校验，比如程序链接过来是有哪个库的权限的，或者哪个库的表权限，都需要去指定用户名/密码，会分配一个线程给到对应的用户来使用，线程是可以复用的</p>
<p>SQL接口：负责各种语句程序，存储过程的实现，比如DML修改(insert，update，delete，alter)，DDL(create，drop)等，视图(select)，存储过程(procedure等)</p>
<p>对于某个表的授权</p>
<p>cache &amp; buffer：将热点数据保存到读缓存(cache)和写缓存(buffers)里面</p>
<p>3.存储引擎：决定了MySQL在服务器上的保存方式，一般使用Innodb的存储引擎—&gt;innodb</p>
<p>4.MySQL服务器的管理：备份工具，恢复工具，主从同步工具，配置编译工具等</p>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>主要的两种默认引擎：myisam和innodb的对比</p>
<p>主流还是innodb为主</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">show engine<br>innodb的优点：支持事务，行级别的锁(允许修改访问级别到行)，和外键<br>不同用户进到表里面进行修改，精确到行(row-level)<br><span class="hljs-comment">##查看MySQL数据库的存储引擎</span><br>默认使用innodb<br>show engines;<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |<br>| MEMORY             | YES     | Hash based, stored <span class="hljs-keyword">in</span> memory, useful <span class="hljs-keyword">for</span> temporary tables      | NO           | NO   | NO         |<br>| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |<br>| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |<br>| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |<br>| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |<br>| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |<br>| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |<br>| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br></code></pre></td></tr></table></figure>

<h2 id="myIAMS和innodb存储引擎的区别"><a href="#myIAMS和innodb存储引擎的区别" class="headerlink" title="myIAMS和innodb存储引擎的区别"></a>myIAMS和innodb存储引擎的区别</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs none">innodb<br>支持：innodb支持事务(transaction)，行级别的锁(row-level)，外键(foreign key)，支持聚簇索引<br>缺点：库支持最大存储磁盘级别为64TB，但是库的大小到一定级别就会性能很差，需要分库分表执行<br><br>myiams:<br>支持：表级别的锁，适用于只读场景<br>缺点：不支持事务，外键，不支持聚簇索引<br></code></pre></td></tr></table></figure>

<p>存储文件格式：mysql.ibd模式，可以进到一个库的目录里面看</p>
<p>每个表的存储格式：.ibd格式，创建一个表，生成一个.ibd文件</p>
<p><img src="2792175-20220828181332502-2039802505.png" srcset="/img/loading.gif" lazyload alt="image-20220827084219283"></p>
<p>管理数据库引擎(一般不随便动)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查看所有存储引擎<br><span class="hljs-keyword">show</span> engines<br><br>##查看当前的存储引擎，包括临时表也是innodb<br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%storage_engine%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+-----------+</span><br><span class="hljs-operator">|</span> Variable_name                   <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+-----------+</span><br><span class="hljs-operator">|</span> default_storage_engine          <span class="hljs-operator">|</span> InnoDB    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> default_tmp_storage_engine      <span class="hljs-operator">|</span> InnoDB    <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> disabled_storage_engines        <span class="hljs-operator">|</span>           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> internal_tmp_mem_storage_engine <span class="hljs-operator">|</span> TempTable <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+-----------+</span><br><br>##在系统上指定默认的存储引擎<br>vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br>[mysqld]<br>default_storage_engine<span class="hljs-operator">=</span>InnoDB <br><br>##查看某张表的存储引擎，<span class="hljs-keyword">like</span>后面加上表名<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">table</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;testlog&#x27;</span> \G<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>           Name: testlog<br>         Engine: InnoDB<br>        Version: <span class="hljs-number">10</span><br>     Row_format: <span class="hljs-keyword">Dynamic</span><br>           <span class="hljs-keyword">Rows</span>: <span class="hljs-number">98399</span><br> Avg_row_length: <span class="hljs-number">48</span><br>    Data_length: <span class="hljs-number">4734976</span><br>Max_data_length: <span class="hljs-number">0</span><br>   Index_length: <span class="hljs-number">0</span><br>      Data_free: <span class="hljs-number">0</span><br> Auto_increment: <span class="hljs-number">100001</span><br>    Create_time: <span class="hljs-number">2022</span><span class="hljs-number">-08</span><span class="hljs-number">-20</span> <span class="hljs-number">16</span>:<span class="hljs-number">37</span>:<span class="hljs-number">08</span><br>    Update_time: <span class="hljs-keyword">NULL</span><br>     Check_time: <span class="hljs-keyword">NULL</span><br>      <span class="hljs-keyword">Collation</span>: utf8mb3_general_ci<br>       Checksum: <span class="hljs-keyword">NULL</span><br> Create_options: <br>        Comment: <br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="MySQL中的系统数据库"><a href="#MySQL中的系统数据库" class="headerlink" title="MySQL中的系统数据库"></a>MySQL中的系统数据库</h2><p>最好是不要修改，动他，一般都是mysql库修改用户等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">新的库一般包含：<br>information_schema<br>mysql<br>performance_schema<br>sys<br><br>##mysql库：一般都需要进到mysql库内去操作用户，用户权限授权<br>use mysql<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> xxx@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;xxx&#x27;</span><br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> wordpress.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> xxx@<span class="hljs-string">&#x27;%&#x27;</span><br>flush privileges;<br><br><br>information_schema：元数据存储<br>performance_schema：性能表<br>sys：performance_schema精简版<br></code></pre></td></tr></table></figure>

<h1 id="MySQL变量和配置选项"><a href="#MySQL变量和配置选项" class="headerlink" title="MySQL变量和配置选项"></a>MySQL变量和配置选项</h1><p>变量和配置选项不同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">##服务器选项和变量<br>分类：<br><span class="hljs-number">1.</span><span class="hljs-keyword">global</span>变量 <br><span class="hljs-number">2.</span>session变量(单会话框)<br><span class="hljs-number">3.</span><span class="hljs-keyword">dynamic</span>动态变量，可以动态修改，在内存内直接修改<br></code></pre></td></tr></table></figure>

<p>常见的服务器变量，一般是配置常见的服务器变量，比如id，binlog开启，数据目录，服务器sooket，错误日志，pid进程(关乎到启动脚本)等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql">##一般是进入到[mysqld]服务器内进行配置<br>vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br>[mysqld]<br>server<span class="hljs-operator">-</span>id<span class="hljs-operator">=</span><span class="hljs-number">132</span><br>log<span class="hljs-operator">-</span>bin<br>datadir<span class="hljs-operator">=</span><span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>mysql<br>socket<span class="hljs-operator">=</span><span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>mysql.sock                                                                                                   <br>log<span class="hljs-operator">-</span>error<span class="hljs-operator">=</span><span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>mysql.log<br>pid<span class="hljs-operator">-</span>file<span class="hljs-operator">=</span><span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>mysql.pid<br>#<span class="hljs-keyword">skip</span><span class="hljs-operator">-</span><span class="hljs-keyword">grant</span><span class="hljs-operator">-</span>tables<br>#default_authentication_plugin<span class="hljs-operator">=</span>mysql_native_password<br><br>[client]<br>socket<span class="hljs-operator">=</span><span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>mysql.sock<br><br><br>##mysql <span class="hljs-comment">--verbose --help</span><br>Variables (<span class="hljs-comment">--variable-name=value)</span><br><span class="hljs-keyword">and</span> <span class="hljs-type">boolean</span> options &#123;<span class="hljs-literal">FALSE</span><span class="hljs-operator">|</span><span class="hljs-literal">TRUE</span>&#125;          <span class="hljs-keyword">Value</span> (after reading options)<br><span class="hljs-comment">----------------------------------------- --------------------------------</span><br>auto<span class="hljs-operator">-</span>rehash                               <span class="hljs-literal">TRUE</span><br>auto<span class="hljs-operator">-</span>vertical<span class="hljs-operator">-</span>output                      <span class="hljs-literal">FALSE</span><br>bind<span class="hljs-operator">-</span>address                              (<span class="hljs-keyword">No</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">value</span>)<br><span class="hljs-type">binary</span><span class="hljs-operator">-</span><span class="hljs-keyword">as</span><span class="hljs-operator">-</span>hex                             <span class="hljs-literal">FALSE</span><br><span class="hljs-type">character</span><span class="hljs-operator">-</span>sets<span class="hljs-operator">-</span>dir                        (<span class="hljs-keyword">No</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">value</span>)<br><span class="hljs-keyword">column</span><span class="hljs-operator">-</span>type<span class="hljs-operator">-</span>info                          <span class="hljs-literal">FALSE</span><br></code></pre></td></tr></table></figure>

<h1 id="MySQL索引"><a href="#MySQL索引" class="headerlink" title="MySQL索引"></a>MySQL索引</h1><p>提高数据库查询的效率，主要还是查询，要查询的内容加上次序，这个表建立索引一般在读操作远远大于写操作的基础上，如果进行频繁修改的话，索引需要不断的更新</p>
<p>优点：</p>
<p>1.可以降低扫描的次数，提高IO</p>
<p>2.进行良好的排序</p>
<p>缺点：占用额外磁盘空间，如果写操作次数多余读操作次数，则需要不停的去更新索引，从而影响了库的性能</p>
<h2 id="常见数据结构索引类型"><a href="#常见数据结构索引类型" class="headerlink" title="常见数据结构索引类型"></a>常见数据结构索引类型</h2><p>B+tree索引：常见的索引架构，任意字段的数据，不限制</p>
<p>hash索引：精确查找</p>
<p>主键索引：基于主键做的索引，比如订单表，就是以订单编号(假设auto_increment)，根据这个来查询</p>
<p>聚簇索引：数据+索引放在一起，数据为.idb类型的文件，索引为.idx类型的文件</p>
<h3 id="二叉树形态"><a href="#二叉树形态" class="headerlink" title="二叉树形态"></a>二叉树形态</h3><p>有树根的情况，一直往下建立索引查询，二分法，以树根为基准，比如说左边是小于树根的，右边是大于树根的，然后两种依次往下排，每个分支节点都是这么分的排序方法，依次往下排</p>
<p>每当有大于或者小于的数字，分为放在右边和左边</p>
<p><a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BST.html">Binary Search Tree Visualization (usfca.edu)</a></p>
<p><img src="2792175-20220828181332807-701284451.png" srcset="/img/loading.gif" lazyload alt="image-20220827143011464"></p>
<h3 id="B-tree索引：balance-index"><a href="#B-tree索引：balance-index" class="headerlink" title="B-tree索引：balance index"></a>B-tree索引：balance index</h3><p>特点：平衡性好，比纯二叉树的话，覆盖到所有的数据；</p>
<p>硬盘1（页1—&gt;16K的大小）：存放17号和35号的学生信息，有p1，p2，p3三个指针指向三个range：&lt;17，17&lt;x&lt;35，x&gt;35，三个范围内出现三个硬盘快，再依次往下分，直到不能分为止</p>
<p>优点：比二叉树索引更加平衡，能找到所有范围内的数据</p>
<p>缺点：需要遍历太多次了，如果有些数据在最底层，影响程序性能，看查询的数据是什么数据</p>
<p><img src="2792175-20220828181333197-1457857707.png" srcset="/img/loading.gif" lazyload alt="image-20220827142611865"></p>
<h3 id="B-tree索引-mysql使用"><a href="#B-tree索引-mysql使用" class="headerlink" title="B+tree索引(mysql使用)"></a>B+tree索引(mysql使用)</h3><p>关系型数据库常用的索引算法</p>
<p>特点：根节点+分支节点(一共两层)，存放的都是索引的东西，而不存放数据，索引的内容比如是1个数字+指针</p>
<p>5+p1,20+p2,60+p3,</p>
<p>5-20又可以分为5-p1，10-P2，20-p3等等，在这里往下第三层才开始放数据，1条记录假设占用1K的空间</p>
<p>优势：树的层数一般就是2-3层，IO快，适用于普遍的情况，同时表下面加上了链表，二层每个索引下面的数据都是有链接关系的，可以直接跳转，不用又从根上开始找，大大提升找查询的效率</p>
<p>查询路径：根据索引查询</p>
<p>查询条件限定：左前缀排序法，因为索引一般都是根据一定的排序方式进行建立的，比如查询所有1000开头的订单号记录ok，查询包含520的订单记录，就不行，或者查询某个用户的订单，OK</p>
<p><img src="2792175-20220828181333585-1334419259.png" srcset="/img/loading.gif" lazyload alt="image-20220827162243054"></p>
<p>面试题：innbodb中一个B+树可以放多少条记录？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">假设：<span class="hljs-number">2</span>层架构+数据<br>根节点：<span class="hljs-number">1</span>个索引=数字+指针，<span class="hljs-number">10</span>个字节，存放一个索引的页为16K大小，可以放<span class="hljs-number">1.</span>6K条索引<br>分支节点：<br>一条记录：1K的占用，<span class="hljs-number">1</span>页能放：<span class="hljs-number">16</span>条记录=16K，<span class="hljs-number">1</span>条索引对应<span class="hljs-number">16</span>条记录，<span class="hljs-number">1</span>个分支可放：<span class="hljs-number">1.</span>6k*<span class="hljs-number">16</span>=<span class="hljs-number">25600</span>条记录<br>一共有包括根节点：<span class="hljs-number">1.</span>6k*<span class="hljs-number">25600</span>记录=<span class="hljs-number">40960000</span>条记录<br>一个<span class="hljs-title class_">MySQL</span>库最多能放这么多条记录，但是实际生产环境下，超过千万条就最好是分库了<br></code></pre></td></tr></table></figure>

<h2 id="管理索引语句"><a href="#管理索引语句" class="headerlink" title="管理索引语句"></a>管理索引语句</h2><p>适用场景：一个表内，最好是2-3个索引就OK，一般用于经常查询的字段，比如ID，货品名称等，索引多了也会带来额外的损耗</p>
<p>索引—-&gt;一定是基于某张表的，不同的表可以建立属于表自己的索引</p>
<p>MySQL库有自己的优化器，一般会选择用不用自建的索引来查询，一般来说对于单表都会使用的，基本都是B+TREE索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs sql">##创建索引，查看某张表的索引，删除索引<br><span class="hljs-keyword">create</span> index name <span class="hljs-keyword">on</span> testlog(name);<br><span class="hljs-keyword">show</span> indexes <span class="hljs-keyword">from</span> testlog\G; <span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> testlog;<br><span class="hljs-keyword">drop</span> index idex_salary <span class="hljs-keyword">on</span> testlog;<br><br><br>##查看表结构，stuid为主键，自增长<br><span class="hljs-keyword">desc</span> students<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> Field     <span class="hljs-operator">|</span> Type             <span class="hljs-operator">|</span> <span class="hljs-keyword">Null</span> <span class="hljs-operator">|</span> Key <span class="hljs-operator">|</span> <span class="hljs-keyword">Default</span> <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-operator">|</span> StuID     <span class="hljs-operator">|</span> <span class="hljs-type">int</span> unsigned     <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span> PRI <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> auto_increment <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Name      <span class="hljs-operator">|</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>)      <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Age       <span class="hljs-operator">|</span> tinyint unsigned <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> Gender    <span class="hljs-operator">|</span> enum(<span class="hljs-string">&#x27;F&#x27;</span>,<span class="hljs-string">&#x27;M&#x27;</span>)    <span class="hljs-operator">|</span> <span class="hljs-keyword">NO</span>   <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> ClassID   <span class="hljs-operator">|</span> tinyint unsigned <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> TeacherID <span class="hljs-operator">|</span> <span class="hljs-type">int</span> unsigned     <span class="hljs-operator">|</span> YES  <span class="hljs-operator">|</span>     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span>                <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------+------------------+------+-----+---------+----------------+</span><br><span class="hljs-number">6</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##查找某个表的索引，索引类型为btree索引，默认都是btree索引，默认都是b<span class="hljs-operator">+</span>tree索引<br>##主键索引<span class="hljs-operator">+</span>STUID为主键<br><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> students\G;<br><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><br>        <span class="hljs-keyword">Table</span>: students<br>   Non_unique: <span class="hljs-number">0</span><br>     Key_name: <span class="hljs-keyword">PRIMARY</span><br> Seq_in_index: <span class="hljs-number">1</span><br>  Column_name: StuID<br>    <span class="hljs-keyword">Collation</span>: A<br>  <span class="hljs-keyword">Cardinality</span>: <span class="hljs-number">25</span><br>     Sub_part: <span class="hljs-keyword">NULL</span><br>       Packed: <span class="hljs-keyword">NULL</span><br>         <span class="hljs-keyword">Null</span>: <br>   Index_type: BTREE<br>      Comment: <br>Index_comment: <br>      Visible: YES<br>   Expression: <span class="hljs-keyword">NULL</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181333908-1357973310.png" srcset="/img/loading.gif" lazyload alt="image-20220827174209385"></p>
<p>查看是否有利用索引来进行查询：explain</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hellodb.students <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">6</span>;<br>key：是<span class="hljs-keyword">primary</span>，证明就是主键索引，有利用索引的<br><span class="hljs-keyword">rows</span>：表示扫描了多少行得出来的<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181334197-1371778287.png" srcset="/img/loading.gif" lazyload alt="image-20220827172521077"></p>
<p>查询年龄(age字段)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">##没有加索引的查询，<span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">25</span>意味着遍历了<span class="hljs-number">25</span>条数据才查出来有年龄<span class="hljs-operator">=</span><span class="hljs-number">22</span>的记录<br><span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">25</span><br>type<span class="hljs-operator">=</span><span class="hljs-keyword">ALL</span><span class="hljs-comment">---&gt;全表扫描</span><br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hellodb.students <span class="hljs-keyword">where</span> age<span class="hljs-operator">=</span><span class="hljs-number">22</span>;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181334489-484357407.png" srcset="/img/loading.gif" lazyload alt="image-20220827172837889"></p>
<h3 id="创建索引：explain查看索引使用"><a href="#创建索引：explain查看索引使用" class="headerlink" title="创建索引：explain查看索引使用"></a>创建索引：explain查看索引使用</h3><p>MySQL内会有一定的优化，即使创建了索引也不一定使用，有时候全表查询快过索引的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students;<br><span class="hljs-keyword">create</span> INDEX idx_stuname(索引名称) <span class="hljs-keyword">on</span> students(name)(表名(字段名)); ##想截取字段名前几位，可以写(name(<span class="hljs-number">5</span>))<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hellodb.students <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;Shi Zhongyu&#x27;</span>;<br><br>##结果：遍历了<span class="hljs-number">1</span>行就出来了，利用了索引进行查询<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181334776-1318141981.png" srcset="/img/loading.gif" lazyload alt="image-20220827173958689"></p>
<p>姓名：一般都是左前缀匹配，这里查询以s开头的条目，也是利用了索引的，key这里都有用到idx_stuname</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hellodb.students <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;s%&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> hellodb.students <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;s%&#x27;</span>;<br><span class="hljs-number">2</span>	Shi Potian	<span class="hljs-number">22</span>	M	<span class="hljs-number">1</span>	<span class="hljs-number">7</span><br><span class="hljs-number">6</span>	Shi Qing	<span class="hljs-number">46</span>	M	<span class="hljs-number">5</span>	<br><span class="hljs-number">1</span>	Shi Zhongyu	<span class="hljs-number">22</span>	M	<span class="hljs-number">2</span>	<span class="hljs-number">3</span><br><span class="hljs-number">25</span>	Sun Dasheng	<span class="hljs-number">100</span>	M		<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181335069-895777315.png" srcset="/img/loading.gif" lazyload alt="image-20220827174640794"></p>
<h3 id="10万条记录表创建索引优化查询速度"><a href="#10万条记录表创建索引优化查询速度" class="headerlink" title="10万条记录表创建索引优化查询速度"></a>10万条记录表创建索引优化查询速度</h3><p>大表尽量避免做全表扫描</p>
<p>之前由存储过程生成的10w条记录的表testlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">##普通查询<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testlog;<br><span class="hljs-number">99995</span>	wang12462	<span class="hljs-number">573325</span><br><span class="hljs-number">99996</span>	wang49273	<span class="hljs-number">743714</span><br><span class="hljs-number">99997</span>	wang24035	<span class="hljs-number">970637</span><br><span class="hljs-number">99998</span>	wang13211	<span class="hljs-number">748677</span><br><span class="hljs-number">99999</span>	wang34703	<span class="hljs-number">489141</span><br><span class="hljs-number">100000</span>	wang40460	<span class="hljs-number">555592</span><br><br>##加入<span class="hljs-keyword">where</span>条件<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testlog <span class="hljs-keyword">where</span> salary<span class="hljs-operator">=</span><span class="hljs-number">489141</span>; <br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testlog <span class="hljs-keyword">where</span> salary<span class="hljs-operator">=</span><span class="hljs-number">489141</span>;<br><br>##创建salary的索引<br><span class="hljs-keyword">create</span> index idx_salary <span class="hljs-keyword">on</span> testlog(salary);<br><br>##查看<span class="hljs-keyword">sql</span>语句的执行情况，可以看到以索引来查询比没有索引的速度快了将近<span class="hljs-number">20</span>倍<br><span class="hljs-keyword">set</span> profiling<span class="hljs-operator">=</span><span class="hljs-keyword">ON</span>;<br><span class="hljs-keyword">show</span> profiles;<br><span class="hljs-keyword">show</span> profiles <span class="hljs-keyword">for</span> query ID;<br><br>遍历<span class="hljs-number">100</span>万条记录查询出一个salary的值，使用索引是<span class="hljs-number">0.0003</span>s，不使用索引是<span class="hljs-number">0.01</span>s，速度有很大的差别了<br>(root<span class="hljs-variable">@localhost</span>) [hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> profiles;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------+-------------------------------------------+</span><br><span class="hljs-operator">|</span> Query_ID <span class="hljs-operator">|</span> Duration   <span class="hljs-operator">|</span> Query                                     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------+-------------------------------------------+</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00030300</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testlog <span class="hljs-keyword">where</span> salary<span class="hljs-operator">=</span><span class="hljs-number">489141</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00007425</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">drop</span> index idx_salary <span class="hljs-keyword">from</span> testlog        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">3</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.00987600</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">drop</span> index idx_salary <span class="hljs-keyword">on</span> testlog          <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>        <span class="hljs-number">4</span> <span class="hljs-operator">|</span> <span class="hljs-number">0.01724175</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> testlog <span class="hljs-keyword">where</span> salary<span class="hljs-operator">=</span><span class="hljs-number">489141</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+------------+-------------------------------------------+</span><br></code></pre></td></tr></table></figure>

<h1 id="MySQL并发控制：锁"><a href="#MySQL并发控制：锁" class="headerlink" title="MySQL并发控制：锁"></a>MySQL并发控制：锁</h1><p>手动添加锁分为</p>
<p>读锁：对表/行加锁，别人能读，但是不能更改</p>
<p>写锁：对表/行加锁，别人不能读/写，加上排他性，自己掌握控制权</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">lock tables students lock_type(read<span class="hljs-operator">/</span>write)<br>lock tables students read<br><br>##加锁后的效果<br><span class="hljs-keyword">update</span> students <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">50</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>ERROR <span class="hljs-number">1099</span> (HY000): <span class="hljs-keyword">Table</span> <span class="hljs-string">&#x27;students&#x27;</span> was locked <span class="hljs-keyword">with</span> a READ lock <span class="hljs-keyword">and</span> can<span class="hljs-string">&#x27;t be updated</span><br><span class="hljs-string"></span><br><span class="hljs-string">##解锁后就可以写了</span><br><span class="hljs-string">unlock tables;</span><br><span class="hljs-string">update students set age=50 where stuid=1;</span><br><span class="hljs-string">Query OK, 0 rows affected (0.00 sec)</span><br><span class="hljs-string">Rows matched: 1  Changed: 0  Warnings: 0</span><br></code></pre></td></tr></table></figure>

<p>写锁：自己独占表/行的控制权，别的用户不能读或者写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">lock tables students write;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">update</span> <span class="hljs-operator">/</span><span class="hljs-keyword">delete</span>等更新操作都不行<br><br>##查看MySQL的进程正在干嘛<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> processlist;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------------+-----------+---------+---------+------+------------------------+------------------+</span><br><span class="hljs-operator">|</span> Id <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span>            <span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> db      <span class="hljs-operator">|</span> Command <span class="hljs-operator">|</span> <span class="hljs-type">Time</span> <span class="hljs-operator">|</span> State                  <span class="hljs-operator">|</span> Info             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------------+-----------+---------+---------+------+------------------------+------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> event_scheduler <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> Daemon  <span class="hljs-operator">|</span>   <span class="hljs-number">96</span> <span class="hljs-operator">|</span> Waiting <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span> queue <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">8</span> <span class="hljs-operator">|</span> root            <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> hellodb <span class="hljs-operator">|</span> Query   <span class="hljs-operator">|</span>    <span class="hljs-number">0</span> <span class="hljs-operator">|</span> init                   <span class="hljs-operator">|</span> <span class="hljs-keyword">show</span> processlist <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------------+-----------+---------+---------+------+------------------------+------------------+</span><br><br>kill <span class="hljs-operator">+</span>id ##杀掉对应的blocking进程<br>unlock tables;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> students <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+-----+--------+---------+-----------+</span><br><span class="hljs-operator">|</span> StuID <span class="hljs-operator">|</span> Name        <span class="hljs-operator">|</span> Age <span class="hljs-operator">|</span> Gender <span class="hljs-operator">|</span> ClassID <span class="hljs-operator">|</span> TeacherID <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+-----+--------+---------+-----------+</span><br><span class="hljs-operator">|</span>     <span class="hljs-number">1</span> <span class="hljs-operator">|</span> Shi Zhongyu <span class="hljs-operator">|</span>  <span class="hljs-number">50</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span>       <span class="hljs-number">2</span> <span class="hljs-operator">|</span>         <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+-------------+-----+--------+---------+-----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">6.30</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="死锁问题：事务执行没完成-未提交-未回滚"><a href="#死锁问题：事务执行没完成-未提交-未回滚" class="headerlink" title="死锁问题：事务执行没完成/未提交/未回滚"></a>死锁问题：事务执行没完成/未提交/未回滚</h2><p>user1在改user2的记录，由于innodb的特性，修改某一条记录的时候，会在这条row上面加锁，所以user1就无法修改，造成死锁；</p>
<p>user2修改user1正在改的数据，也会造成死锁</p>
<p>解决：MySQL内的机制会直接杀掉一个进程，unlock死锁</p>
<p>可以看到哪个user在搞</p>
<p>像这个使用了select * 查询表的，因为可能没做索引，所以需要遍历整张表，造成商城数据库性能达到瓶颈，已经不给操作了(读/写)—&gt;应该是对表加了写锁—&gt;死锁，别人读/写这张表都不行了，显示超时timeout之类的；</p>
<p>他是select *，不知道是对表级别的还是对行级别的，总之类似下单表之类的都无法执行读写了，即用户(相当于库的其他访问用户)无法下单，更新库的信息了，不能对表进行读/修改</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> processlist;<br>kill <span class="hljs-operator">+</span>query id;<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181335359-1422421541.png" srcset="/img/loading.gif" lazyload alt="image-20220828082629405"></p>
<p>死锁案例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs sql">##如果加<span class="hljs-keyword">where</span>条件，就是单挑记录；如果不加<span class="hljs-keyword">where</span>，代表是整张表的修改<span class="hljs-comment">---&gt;不一样的</span><br><span class="hljs-keyword">update</span> stu <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">10</span>;<br><span class="hljs-keyword">update</span> stu <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">10</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">90</span>;<br><br>##user1在执行这个事务，<span class="hljs-keyword">begin</span>，还没<span class="hljs-keyword">commit</span>，人走了<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">begin</span>;<span class="hljs-keyword">update</span> students <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">10</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br><span class="hljs-keyword">commit</span>;<br><br>##user1 <span class="hljs-keyword">commit</span>后，才可以<br>##user2，修改stuid的值，发现一只卡住，就是死锁了，因为user1访问的事务还没提交，导致<span class="hljs-type">row</span>级别加了写锁，导致无法读写操作，user2对于这条<span class="hljs-type">row</span>的操作一直在等待<br>##报错:timeout<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">update</span> stu <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br><br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">update</span> stu <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>ERROR <span class="hljs-number">1205</span> (HY000): Lock wait timeout exceeded; try restarting transaction ##尝试重新提交事务<br><br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">update</span> stu <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">20</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br><br>##观察存储引擎<br><span class="hljs-keyword">show</span> innodb engine status;<br><br>##sleep <span class="hljs-number">673</span>代表一直在等待，干掉<br>##daemon代表守护进程<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> processlist;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------------+-----------+---------+---------+------+------------------------+------------------+</span><br><span class="hljs-operator">|</span> Id <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span>            <span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> db      <span class="hljs-operator">|</span> Command <span class="hljs-operator">|</span> <span class="hljs-type">Time</span> <span class="hljs-operator">|</span> State                  <span class="hljs-operator">|</span> Info             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------------+-----------+---------+---------+------+------------------------+------------------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">5</span> <span class="hljs-operator">|</span> event_scheduler <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> Daemon  <span class="hljs-operator">|</span> <span class="hljs-number">3065</span> <span class="hljs-operator">|</span> Waiting <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span> queue <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">11</span> <span class="hljs-operator">|</span> root            <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> hellodb <span class="hljs-operator">|</span> Sleep   <span class="hljs-operator">|</span>  <span class="hljs-number">673</span> <span class="hljs-operator">|</span>                        <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>             <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> <span class="hljs-number">13</span> <span class="hljs-operator">|</span> root            <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> hellodb <span class="hljs-operator">|</span> Query   <span class="hljs-operator">|</span>    <span class="hljs-number">0</span> <span class="hljs-operator">|</span> init                   <span class="hljs-operator">|</span> <span class="hljs-keyword">show</span> processlist <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-----------------+-----------+---------+---------+------+------------------------+------------------+</span><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181335645-1243727137.png" srcset="/img/loading.gif" lazyload alt="image-20220828111220786"></p>
<h1 id="MySQL事务"><a href="#MySQL事务" class="headerlink" title="MySQL事务"></a>MySQL事务</h1><p>事务：一组由SQL语句组成的整体，或者独立工作的单元—面试重点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##面试重点</span><br>事务的4个特性<br>A：原子性，整个事务中要么全部执行成功，要么全部失败回滚，唯一性，不可分割的步骤<br>C：一致性，必须遵循能量守恒定律，比如银行转账1000块，对方银行必定增加1000块，不存在转账后，1000块没了，双方平衡，双方加起来钱还是一致的<br>I：隔离性，即事务还未提交的时候，(还没显示结果)，别人看不到你提交了一半的事务的过程---&gt;dirty data脏数据，没有具体落地的东西<br>D：持久型，一旦事务提交，修改永久保存在数据库中<br></code></pre></td></tr></table></figure>

<p>事务的生命周期：</p>
<p>1.开始事务</p>
<p>2.执行其中的增删改查等SQL语句—&gt;一般为DML语句</p>
<p>3.提交(commit)/回滚(rollback)</p>
<p>4.更新到DB中</p>
<p><img src="2792175-20220828181336934-1817115279.png" srcset="/img/loading.gif" lazyload alt="image-20220828090422967"></p>
<p>具体执行过程，一定要分开执行事务才行，每一条都是一个语句来的，要用分号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span>; ##<span class="hljs-keyword">begin</span>启动事务<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> teachers(name,age,gender) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;catyer&#x27;</span>,<span class="hljs-number">10</span>,<span class="hljs-string">&#x27;M&#x27;</span>); ##DML语句对表进行操作<br><span class="hljs-keyword">COMMIT</span>; ##提交<br><br><span class="hljs-keyword">rollback</span>; ##回滚事务，回滚自己这个用户的操作<br><br>##本地终端(操作用户)已经看到有记录生成了，别的终端还没看到<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> teachers;             <br><span class="hljs-operator">+</span><span class="hljs-comment">-----+---------------+-----+--------+</span><br><span class="hljs-operator">|</span> TID <span class="hljs-operator">|</span> Name          <span class="hljs-operator">|</span> Age <span class="hljs-operator">|</span> Gender <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----+---------------+-----+--------+</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> Song Jiang    <span class="hljs-operator">|</span> <span class="hljs-number">100</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span> Zhang Sanfeng <span class="hljs-operator">|</span>  <span class="hljs-number">94</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Miejue Shitai <span class="hljs-operator">|</span>  <span class="hljs-number">77</span> <span class="hljs-operator">|</span> F      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Lin Chaoying  <span class="hljs-operator">|</span>  <span class="hljs-number">93</span> <span class="hljs-operator">|</span> F      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">5</span> <span class="hljs-operator">|</span> catyer        <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">6</span> <span class="hljs-operator">|</span> catyer        <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">7</span> <span class="hljs-operator">|</span> catyer11      <span class="hljs-operator">|</span>  <span class="hljs-number">11</span> <span class="hljs-operator">|</span> F      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----+---------------+-----+--------+     </span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-number">1</span>	Song Jiang	<span class="hljs-number">100</span>	M<br><span class="hljs-number">2</span>	Zhang Sanfeng	<span class="hljs-number">94</span>	M<br><span class="hljs-number">3</span>	Miejue Shitai	<span class="hljs-number">77</span>	F<br><span class="hljs-number">4</span>	Lin Chaoying	<span class="hljs-number">93</span>	F<br><span class="hljs-number">5</span>	catyer	<span class="hljs-number">10</span>	M<br><span class="hljs-number">6</span>	catyer	<span class="hljs-number">10</span>	M<br><br>##执行<span class="hljs-keyword">commit</span>，别的用户可以看到了<br><span class="hljs-number">1</span>	Song Jiang	<span class="hljs-number">100</span>	M<br><span class="hljs-number">2</span>	Zhang Sanfeng	<span class="hljs-number">94</span>	M<br><span class="hljs-number">3</span>	Miejue Shitai	<span class="hljs-number">77</span>	F<br><span class="hljs-number">4</span>	Lin Chaoying	<span class="hljs-number">93</span>	F<br><span class="hljs-number">5</span>	catyer	<span class="hljs-number">10</span>	M<br><span class="hljs-number">6</span>	catyer	<span class="hljs-number">10</span>	M<br><span class="hljs-number">7</span>	catyer11	<span class="hljs-number">11</span>	F<br></code></pre></td></tr></table></figure>

<p>注意：在未提交或者回滚后，别人是看不到这个结果的，事务的隔离性，还未提交，例如我在网站上填写一个表单，还没点击提交</p>
<h2 id="利用事务提高DML语句的执行速度"><a href="#利用事务提高DML语句的执行速度" class="headerlink" title="利用事务提高DML语句的执行速度"></a>利用事务提高DML语句的执行速度</h2><p>事务可以将待提交的SQL语句写入到MySQL的缓冲区中，类似git commit提交到暂存区，对比直接执行存储过程的速度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">##批量化插入<span class="hljs-number">10</span>w条记录，用了大概<span class="hljs-number">2</span>s<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">begin</span>;<span class="hljs-keyword">call</span> sp_testlog;<span class="hljs-keyword">commit</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">2.35</span> sec)<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br><br>##普通，用了<span class="hljs-number">50</span>多s<br><span class="hljs-keyword">call</span> sp_testlog;<br>(root<span class="hljs-variable">@localhost</span>) [hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">call</span> sp_testlog;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">57.04</span> sec)<br><br>##一共有<span class="hljs-number">30</span>w条记录，没问题<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> testlog;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">300000</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.03</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="rollback回滚：不能回滚DDL语句，即create-drop等操作，可以回滚DML"><a href="#rollback回滚：不能回滚DDL语句，即create-drop等操作，可以回滚DML" class="headerlink" title="rollback回滚：不能回滚DDL语句，即create/drop等操作，可以回滚DML"></a>rollback回滚：不能回滚DDL语句，即create/drop等操作，可以回滚DML</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs sql">##<span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span>可以撤销，<span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span>不能撤销<br>(root<span class="hljs-variable">@localhost</span>) [hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">begin</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>(root<span class="hljs-variable">@localhost</span>) [hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> teachers;<br>Query OK, <span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>(root<span class="hljs-variable">@localhost</span>) [hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> teachers;<br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##对于<span class="hljs-keyword">delete</span>操作，可以撤销的<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">rollback</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> teachers;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----+---------------+-----+--------+</span><br><span class="hljs-operator">|</span> TID <span class="hljs-operator">|</span> Name          <span class="hljs-operator">|</span> Age <span class="hljs-operator">|</span> Gender <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----+---------------+-----+--------+</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span> Song Jiang    <span class="hljs-operator">|</span> <span class="hljs-number">100</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span> Zhang Sanfeng <span class="hljs-operator">|</span>  <span class="hljs-number">94</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">3</span> <span class="hljs-operator">|</span> Miejue Shitai <span class="hljs-operator">|</span>  <span class="hljs-number">77</span> <span class="hljs-operator">|</span> F      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">4</span> <span class="hljs-operator">|</span> Lin Chaoying  <span class="hljs-operator">|</span>  <span class="hljs-number">93</span> <span class="hljs-operator">|</span> F      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">5</span> <span class="hljs-operator">|</span> catyer        <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">6</span> <span class="hljs-operator">|</span> catyer        <span class="hljs-operator">|</span>  <span class="hljs-number">10</span> <span class="hljs-operator">|</span> M      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>   <span class="hljs-number">7</span> <span class="hljs-operator">|</span> catyer11      <span class="hljs-operator">|</span>  <span class="hljs-number">11</span> <span class="hljs-operator">|</span> F      <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----+---------------+-----+--------+</span><br><span class="hljs-number">7</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<h2 id="执行了begin未提交的事务：脏数据dirty-data"><a href="#执行了begin未提交的事务：脏数据dirty-data" class="headerlink" title="执行了begin未提交的事务：脏数据dirty data"></a>执行了begin未提交的事务：脏数据dirty data</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span>;<br><span class="hljs-keyword">update</span> stu <span class="hljs-keyword">set</span> age<span class="hljs-operator">=</span><span class="hljs-number">50</span> <span class="hljs-keyword">where</span> stuid<span class="hljs-operator">=</span><span class="hljs-number">1</span>; <span class="hljs-comment">---&gt;脏数据</span><br></code></pre></td></tr></table></figure>

<h2 id="不同DB类型的事务提交：autocommit"><a href="#不同DB类型的事务提交：autocommit" class="headerlink" title="不同DB类型的事务提交：autocommit"></a>不同DB类型的事务提交：autocommit</h2><p>MySQL：自动提交，commit</p>
<p>PG：自动提交</p>
<p>SQL server：自动提交</p>
<p>Ooracle：不会自动提交，执行了DML，再执行commit才能提交—&gt;安全</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> @<span class="hljs-variable">@autocommit</span>;<br><span class="hljs-keyword">set</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> @<span class="hljs-variable">@autocommit</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------+</span><br><span class="hljs-operator">|</span> @<span class="hljs-variable">@autocommit</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------+</span><br><span class="hljs-operator">|</span>            <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------+</span><br><br>##防止自动提交，全局设置非自动提交<br><span class="hljs-keyword">set</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> autocommit<span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>

<h2 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h2><p>MySQL支持四种事务隔离级别</p>
<p><img src="2792175-20220828181335941-1360491626.png" srcset="/img/loading.gif" lazyload alt="image-20220828114818137"></p>
<p>读未提交read uncomimited：可读取到未提交的数据</p>
<p>读提交read commited：可读取提交的数据，但是未提交的数据不可读，导致每次读取的数据不一致(比如不同用户再执行，看到的都是自己执行的事务修改，别的人修改后的最终数据看不到)</p>
<p>幻读(可重复读)：永远看到是最初的样子，没经过修改的，别人提交多少次，我这个用户都看不到(MySQL默认事务隔离级别)</p>
<p>创新：读操作加读锁，写操作加写锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">##查询事务隔离级别，默认是幻读<br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> @<span class="hljs-variable">@transaction</span>_isolation;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> @<span class="hljs-variable">@transaction</span>_isolation <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-operator">|</span> REPEATABLE<span class="hljs-operator">-</span>READ         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>##配置MySQL的事务隔离级别，读未提交<br>vim <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br>transaction<span class="hljs-operator">-</span>isolation<span class="hljs-operator">=</span>read<span class="hljs-operator">-</span>uncommited<br>transaction<span class="hljs-operator">-</span>isolation<span class="hljs-operator">=</span>read<span class="hljs-operator">-</span>commited ##读提交，<span class="hljs-keyword">commit</span>后能看到<br>重启服务<br><br>##幻读级别：适用于备份场景<br>repeatable<span class="hljs-operator">-</span>read<span class="hljs-comment">---&gt;保证我在备份的时候，备份的是原始数据，不会在别人操作的时候提交事务，而修改了原数据</span><br></code></pre></td></tr></table></figure>

<h1 id="MySQL日志管理"><a href="#MySQL日志管理" class="headerlink" title="MySQL日志管理"></a>MySQL日志管理</h1><h2 id="事务日志：记录每次执行事务的操作"><a href="#事务日志：记录每次执行事务的操作" class="headerlink" title="事务日志：记录每次执行事务的操作"></a>事务日志：记录每次执行事务的操作</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">事务日志执行逻辑：<br><span class="hljs-number">1.</span>想要修改表，update操作，磁盘内先加载到内存中要执行<br><span class="hljs-number">2.</span>在内存中执行完update<br><span class="hljs-number">3.</span>结果先写入到事务日志，这一条操作确认是已经完成的<br><span class="hljs-number">4.</span>如无网络断电原因，在从内存中写入到磁盘，数据落盘<br><br>##事务日志文件是否会写满？<br>不会，达到一定的大小后会覆盖写<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181337278-1027259050.png" srcset="/img/loading.gif" lazyload alt="image-20220828152754887"></p>
<p>事务日志分类：</p>
<p>redo log：记录某数据块被修改后的值，DML语句，可以用于导入会系统，恢复未写入的数据</p>
<p>undo log：记录某数据块被修改前的值，用于rollback操作</p>
<p>查看事务日志，最大值：50M</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%innodb_log%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+----------+</span><br><span class="hljs-operator">|</span> Variable_name                      <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+----------+</span><br><span class="hljs-operator">|</span> innodb_log_buffer_size             <span class="hljs-operator">|</span> <span class="hljs-number">16777216</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_checksums               <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_compressed_pages        <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_file_size               <span class="hljs-operator">|</span> <span class="hljs-number">50331648</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_files_in_group          <span class="hljs-operator">|</span> <span class="hljs-number">2</span>        <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_group_home_dir          <span class="hljs-operator">|</span> .<span class="hljs-operator">/</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_spin_cpu_abs_lwm        <span class="hljs-operator">|</span> <span class="hljs-number">80</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_spin_cpu_pct_hwm        <span class="hljs-operator">|</span> <span class="hljs-number">50</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_wait_for_flush_spin_hwm <span class="hljs-operator">|</span> <span class="hljs-number">400</span>      <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_write_ahead_size        <span class="hljs-operator">|</span> <span class="hljs-number">8192</span>     <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> innodb_log_writer_threads          <span class="hljs-operator">|</span> <span class="hljs-keyword">ON</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+----------+</span><br><span class="hljs-number">11</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>ls <span class="hljs-operator">/</span>data<span class="hljs-operator">/</span>mysql<br>[root<span class="hljs-variable">@rocky</span> mysql]#ll <span class="hljs-operator">|</span> grep innodb<br>drwxr<span class="hljs-operator">-</span>x<span class="hljs-comment">---. 2 mysql mysql     4096 8月  28 15:13 #innodb_redo</span><br>drwxr<span class="hljs-operator">-</span>x<span class="hljs-comment">---. 2 mysql mysql      187 8月  28 15:13 #innodb_temp</span><br></code></pre></td></tr></table></figure>

<h2 id="事务日志性能优化"><a href="#事务日志性能优化" class="headerlink" title="事务日志性能优化"></a>事务日志性能优化</h2><p>执行DML语句时写入性能修改</p>
<p>默认的事务日志性能级别1，遵从ACID，但是并发的性能差</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1.</span>为默认值，日志缓冲区写入文件，事务提交后落盘<br><span class="hljs-number">0.</span>性能好<br><span class="hljs-number">2.</span>性能比<span class="hljs-number">0</span>差一点，但是安全性高，建议高并发业务选择<span class="hljs-number">2</span><br><br>[hellodb]<span class="hljs-operator">&gt;</span><span class="hljs-keyword">select</span> @<span class="hljs-variable">@innodb</span>_flush_log_at_trx_commit;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------+</span><br><span class="hljs-operator">|</span> @<span class="hljs-variable">@innodb</span>_flush_log_at_trx_commit <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------+</span><br><span class="hljs-operator">|</span>                                <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>

<p><img src="2792175-20220828181337762-1156094993.png" srcset="/img/loading.gif" lazyload alt="image-20220828154502076"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/07/28/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E9%9B%86%E7%BE%A4/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MySQL主从复制与集群</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/28/linux%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1/">
                        <span class="hidden-mobile">linux日志服务</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://qm.qq.com/cgi-bin/qm/qr?k=A5I1aDMT5p5nmi3zDa8t7gWOHawJhjyi&noverify=0&personal_qrcode_source=4" target="_blank" rel="nofollow noopener"><span>JohnBakcu</span></a> <i class="iconfont icon-love"></i> <a href="https://www.magedu.com"  target="_blank" rel="nofollow noopener"><span>Mgedu</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
